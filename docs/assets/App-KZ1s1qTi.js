import{g as ri,a as ii,s as ai,r as v,u as si,j as N,h as oi,i as li,k as ci,_ as ui,R as Yt,o as di,T as Nn,l as fi}from"./index-DCp964Q0.js";import{P as oa,d as We,c as pt,k as Et,V as Se,O as Vn,l as Zn,m as be,n as un,i as en,Q as bt,o as hi,p as _n,E as la,q as ca,r as Rt,I as ua,s as $e,v as pi,t as mi,w as Be,F as Ke,x as St,L as Pe,R as Qt,y as da,z as Fn,A as fa,B as ut,J as yn,K as vi,W as Xe,U as xn,N as ha,X as pa,Y as Kt,Z as dt,_ as ma,$ as va,a0 as ga,a1 as gi,a2 as ht,a3 as yi,a4 as vn,a5 as ya,a6 as xa,a7 as lr,a8 as Qe,a9 as Ct,aa as wn,ab as wa,ac as Ea,ad as Sa,ae as _a,af as Ma,ag as $n,b as cr,ah as Ta,ai as ba,aj as Ra,ak as Xn,al as xi,am as At,an as Tt,ao as Ca,ap as Aa,aq as dn,ar as wi,as as ae,at as Ei,au as Ia,av as qn,aw as Si,ax as ur,ay as Pa,e as _i,G as Da,g as La,az as Ba,h as Oa,M as gn,C as Na,aA as Fa,aB as dr,aC as Ua,j as Ha,D as za,S as ka,H as Ga,aD as Wa}from"./HamburgerMenu-xN1gZuYg.js";function ja(e){return ii("MuiCard",e)}ri("MuiCard",["root"]);const Va=e=>{const{classes:t}=e;return li({root:["root"]},ja,t)},Za=ai(oa,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})({overflow:"hidden"}),$a=v.forwardRef(function(t,n){const r=si({props:t,name:"MuiCard"}),{className:a,raised:o=!1,...l}=r,u={...r,raised:o},d=Va(u);return N.jsx(Za,{className:oi(d.root,a),elevation:o?8:void 0,ref:n,ownerState:u,...l})});function Xa(e){return ii("MuiCardContent",e)}ri("MuiCardContent",["root"]);const qa=e=>{const{classes:t}=e;return li({root:["root"]},Xa,t)},Ya=ai("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:16,"&:last-child":{paddingBottom:24}}),Qa=v.forwardRef(function(t,n){const r=si({props:t,name:"MuiCardContent"}),{className:a,component:o="div",...l}=r,u={...r,component:o},d=qa(u);return N.jsx(Ya,{as:o,className:oi(d.root,a),ownerState:u,ref:n,...l})}),tn=new Se,Yn=new Se,Ka=new Se,fr=new be;function Ja(e,t,n){const r=tn.setFromMatrixPosition(e.matrixWorld);r.project(t);const a=n.width/2,o=n.height/2;return[r.x*a+a,-(r.y*o)+o]}function es(e,t){const n=tn.setFromMatrixPosition(e.matrixWorld),r=Yn.setFromMatrixPosition(t.matrixWorld),a=n.sub(r),o=t.getWorldDirection(Ka);return a.angleTo(o)>Math.PI/2}function ts(e,t,n,r){const a=tn.setFromMatrixPosition(e.matrixWorld),o=a.clone();o.project(t),fr.set(o.x,o.y),n.setFromCamera(fr,t);const l=n.intersectObjects(r,!0);if(l.length){const u=l[0].distance;return a.distanceTo(n.ray.origin)<u}return!0}function ns(e,t){if(t instanceof Vn)return t.zoom;if(t instanceof Zn){const n=tn.setFromMatrixPosition(e.matrixWorld),r=Yn.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,o=n.distanceTo(r);return 1/(2*Math.tan(a/2)*o)}else return 1}function rs(e,t,n){if(t instanceof Zn||t instanceof Vn){const r=tn.setFromMatrixPosition(e.matrixWorld),a=Yn.setFromMatrixPosition(t.matrixWorld),o=r.distanceTo(a),l=(n[1]-n[0])/(t.far-t.near),u=n[1]-l*t.far;return Math.round(l*o+u)}}const Un=e=>Math.abs(e)<1e-10?0:e;function Mi(e,t,n=""){let r="matrix3d(";for(let a=0;a!==16;a++)r+=Un(t[a]*e.elements[a])+(a!==15?",":")");return n+r}const is=(e=>t=>Mi(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),as=(e=>(t,n)=>Mi(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function ss(e){return e&&typeof e=="object"&&"current"in e}const os=v.forwardRef(({children:e,eps:t=.001,style:n,className:r,prepend:a,center:o,fullscreen:l,portal:u,distanceFactor:d,sprite:h=!1,transform:g=!1,occlude:y,onOcclude:_,castShadow:B,receiveShadow:$,material:V,geometry:k,zIndexRange:A=[16777271,0],calculatePosition:H=Ja,as:P="div",wrapperClass:q,pointerEvents:W="auto",...L},J)=>{const{gl:w,camera:x,scene:F,size:I,raycaster:O,events:Z,viewport:U}=We(),[j]=v.useState(()=>document.createElement(P)),S=v.useRef(),X=v.useRef(null),le=v.useRef(0),we=v.useRef([0,0]),ne=v.useRef(null),Ne=v.useRef(null),re=(u==null?void 0:u.current)||Z.connected||w.domElement.parentNode,de=v.useRef(null),Re=v.useRef(!1),qe=v.useMemo(()=>y&&y!=="blending"||Array.isArray(y)&&y.length&&ss(y[0]),[y]);v.useLayoutEffect(()=>{const Ce=w.domElement;y&&y==="blending"?(Ce.style.zIndex=`${Math.floor(A[0]/2)}`,Ce.style.position="absolute",Ce.style.pointerEvents="none"):(Ce.style.zIndex=null,Ce.style.position=null,Ce.style.pointerEvents=null)},[y]),v.useLayoutEffect(()=>{if(X.current){const Ce=S.current=ci.createRoot(j);if(F.updateMatrixWorld(),g)j.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const oe=H(X.current,x,I);j.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${oe[0]}px,${oe[1]}px,0);transform-origin:0 0;`}return re&&(a?re.prepend(j):re.appendChild(j)),()=>{re&&re.removeChild(j),Ce.unmount()}}},[re,g]),v.useLayoutEffect(()=>{q&&(j.className=q)},[q]);const ie=v.useMemo(()=>g?{position:"absolute",top:0,left:0,width:I.width,height:I.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:o?"translate3d(-50%,-50%,0)":"none",...l&&{top:-I.height/2,left:-I.width/2,width:I.width,height:I.height},...n},[n,o,l,I,g]),je=v.useMemo(()=>({position:"absolute",pointerEvents:W}),[W]);v.useLayoutEffect(()=>{if(Re.current=!1,g){var Ce;(Ce=S.current)==null||Ce.render(v.createElement("div",{ref:ne,style:ie},v.createElement("div",{ref:Ne,style:je},v.createElement("div",{ref:J,className:r,style:n,children:e}))))}else{var oe;(oe=S.current)==null||oe.render(v.createElement("div",{ref:J,style:ie,className:r,children:e}))}});const _e=v.useRef(!0);pt(Ce=>{if(X.current){x.updateMatrixWorld(),X.current.updateWorldMatrix(!0,!1);const oe=g?we.current:H(X.current,x,I);if(g||Math.abs(le.current-x.zoom)>t||Math.abs(we.current[0]-oe[0])>t||Math.abs(we.current[1]-oe[1])>t){const Je=es(X.current,x);let Fe=!1;qe&&(Array.isArray(y)?Fe=y.map(et=>et.current):y!=="blending"&&(Fe=[F]));const st=_e.current;if(Fe){const et=ts(X.current,x,O,Fe);_e.current=et&&!Je}else _e.current=!Je;st!==_e.current&&(_?_(!_e.current):j.style.display=_e.current?"block":"none");const mt=Math.floor(A[0]/2),Tn=y?qe?[A[0],mt]:[mt-1,0]:A;if(j.style.zIndex=`${rs(X.current,x,Tn)}`,g){const[et,an]=[I.width/2,I.height/2],It=x.projectionMatrix.elements[5]*an,{isOrthographicCamera:sn,top:bn,left:Rn,bottom:on,right:Cn}=x,Pt=is(x.matrixWorldInverse),An=sn?`scale(${It})translate(${Un(-(Cn+Rn)/2)}px,${Un((bn+on)/2)}px)`:`translateZ(${It}px)`;let tt=X.current.matrixWorld;h&&(tt=x.matrixWorldInverse.clone().transpose().copyPosition(tt).scale(X.current.scale),tt.elements[3]=tt.elements[7]=tt.elements[11]=0,tt.elements[15]=1),j.style.width=I.width+"px",j.style.height=I.height+"px",j.style.perspective=sn?"":`${It}px`,ne.current&&Ne.current&&(ne.current.style.transform=`${An}${Pt}translate(${et}px,${an}px)`,Ne.current.style.transform=as(tt,1/((d||10)/400)))}else{const et=d===void 0?1:ns(X.current,x)*d;j.style.transform=`translate3d(${oe[0]}px,${oe[1]}px,0) scale(${et})`}we.current=oe,le.current=x.zoom}}if(!qe&&de.current&&!Re.current)if(g){if(ne.current){const oe=ne.current.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const{isOrthographicCamera:Je}=x;if(Je||k)L.scale&&(Array.isArray(L.scale)?L.scale instanceof Se?de.current.scale.copy(L.scale.clone().divideScalar(1)):de.current.scale.set(1/L.scale[0],1/L.scale[1],1/L.scale[2]):de.current.scale.setScalar(1/L.scale));else{const Fe=(d||10)/400,st=oe.clientWidth*Fe,mt=oe.clientHeight*Fe;de.current.scale.set(st,mt,1)}Re.current=!0}}}else{const oe=j.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const Je=1/U.factor,Fe=oe.clientWidth*Je,st=oe.clientHeight*Je;de.current.scale.set(Fe,st,1),Re.current=!0}de.current.lookAt(Ce.camera.position)}});const rn=v.useMemo(()=>({vertexShader:g?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[g]);return v.createElement("group",ui({},L,{ref:X}),y&&!qe&&v.createElement("mesh",{castShadow:B,receiveShadow:$,ref:de},k||v.createElement("planeGeometry",null),V||v.createElement("shaderMaterial",{side:Et,vertexShader:rn.vertexShader,fragmentShader:rn.fragmentShader})))}),hr=e=>{let t;const n=new Set,r=(h,g)=>{const y=typeof h=="function"?h(t):h;if(!Object.is(y,t)){const _=t;t=g??(typeof y!="object"||y===null)?y:Object.assign({},t,y),n.forEach(B=>B(t,_))}},a=()=>t,u={setState:r,getState:a,getInitialState:()=>d,subscribe:h=>(n.add(h),()=>n.delete(h))},d=t=e(r,a,u);return u},ls=e=>e?hr(e):hr,cs=e=>e;function us(e,t=cs){const n=Yt.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return Yt.useDebugValue(n),n}const pr=e=>{const t=ls(e),n=r=>us(t,r);return Object.assign(n,t),n},ds=e=>e?pr(e):pr;let Ft=0;const fs=ds(e=>(un.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-Ft)/(r-Ft)*100})},un.onLoad=()=>{e({active:!1})},un.onError=t=>e(n=>({errors:[...n.errors,t]})),un.onProgress=(t,n,r)=>{n===r&&(Ft=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-Ft)/(r-Ft)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hn(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hs(e,t){if(e){if(typeof e=="string")return Hn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hn(e,t)}}function ps(e){if(Array.isArray(e))return Hn(e)}function ms(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function vs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gs(e){return ps(e)||ms(e)||hs(e)||vs()}new be;new be;function ys(e,t,n){return Math.max(t,Math.min(n,e))}function xs(e,t){return ys(e-Math.floor(e/t)*t,0,t)}function ws(e,t){var n=xs(t-e,Math.PI*2);return n>Math.PI&&(n-=Math.PI*2),n}function Ti(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ke=function e(t,n,r){var a=this;Ti(this,e),Xt(this,"dot2",function(o,l){return a.x*o+a.y*l}),Xt(this,"dot3",function(o,l,u){return a.x*o+a.y*l+a.z*u}),this.x=t,this.y=n,this.z=r},Es=[new ke(1,1,0),new ke(-1,1,0),new ke(1,-1,0),new ke(-1,-1,0),new ke(1,0,1),new ke(-1,0,1),new ke(1,0,-1),new ke(-1,0,-1),new ke(0,1,1),new ke(0,-1,1),new ke(0,1,-1),new ke(0,-1,-1)],mr=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],vr=new Array(512),gr=new Array(512),Ss=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var n=0;n<256;n++){var r;n&1?r=mr[n]^t&255:r=mr[n]^t>>8&255,vr[n]=vr[n+256]=r,gr[n]=gr[n+256]=Es[r%12]}};Ss(0);function _s(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var n=0;n<t.length;n++)e=(e+(n+1)*(t.charCodeAt(n)%96))%2147483647}return e===0&&(e=311),e}function yr(e){var t=_s(e);return function(){var n=t*48271%2147483647;return t=n,n/2147483647}}var Ms=function e(t){var n=this;Ti(this,e),Xt(this,"seed",0),Xt(this,"init",function(r){n.seed=r,n.value=yr(r)}),Xt(this,"value",yr(this.seed)),this.init(t)};new Ms(Math.random());var Ts=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*t*a)/n)},bi=function(t){return 1/(1+t+.48*t*t+.235*t*t*t)},bs=function(t){return t},Rs={in:function(t){return 1-Math.cos(t*Math.PI/2)},out:function(t){return Math.sin(t*Math.PI/2)},inOut:function(t){return-(Math.cos(Math.PI*t)-1)/2}},Cs={in:function(t){return t*t*t},out:function(t){return 1-Math.pow(1-t,3)},inOut:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},As={in:function(t){return t*t*t*t*t},out:function(t){return 1-Math.pow(1-t,5)},inOut:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}},Is={in:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},out:function(t){return Math.sqrt(1-Math.pow(t-1,2))},inOut:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}},Ps={in:function(t){return t*t*t*t},out:function(t){return 1- --t*t*t*t},inOut:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}},Ds={in:function(t){return t===0?0:Math.pow(2,10*t-10)},out:function(t){return t===1?1:1-Math.pow(2,-10*t)},inOut:function(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}};function xe(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:bi,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,d="velocity_"+t;if(e.__damp===void 0&&(e.__damp={}),e.__damp[d]===void 0&&(e.__damp[d]=0),Math.abs(e[t]-n)<=u)return e[t]=n,!1;r=Math.max(1e-4,r);var h=2/r,g=l(h*a),y=e[t]-n,_=n,B=o*r;y=Math.min(Math.max(y,-B),B),n=e[t]-y;var $=(e.__damp[d]+h*y)*a;e.__damp[d]=(e.__damp[d]-h*$)*g;var V=n+(y+$)*g;return _-e[t]>0==V>_&&(V=_,e.__damp[d]=(V-_)/a),e[t]=V,!0}var Ls=function(t){return t&&t.isCamera},Bs=function(t){return t&&t.isLight},Ut=new Se,xr=new bt,wr=new bt,Ht=new hi,In=new Se;function Os(e,t,n,r,a,o,l){typeof t=="number"?Ut.setScalar(t):Array.isArray(t)?Ut.set(t[0],t[1],t[2]):Ut.copy(t);var u=e.parent;e.updateWorldMatrix(!0,!1),In.setFromMatrixPosition(e.matrixWorld),Ls(e)||Bs(e)?Ht.lookAt(In,Ut,e.up):Ht.lookAt(Ut,In,e.up),En(e.quaternion,wr.setFromRotationMatrix(Ht),n,r,a,o,l),u&&(Ht.extractRotation(u.matrixWorld),xr.setFromRotationMatrix(Ht),En(e.quaternion,wr.copy(e.quaternion).premultiply(xr.invert()),n,r,a,o,l))}function _t(e,t,n,r,a,o,l,u){return xe(e,t,e[t]+ws(e[t],n),r,a,o,l,u)}var zt=new be,Er,Sr;function Ns(e,t,n,r,a,o,l){return typeof t=="number"?zt.setScalar(t):Array.isArray(t)?zt.set(t[0],t[1]):zt.copy(t),Er=xe(e,"x",zt.x,n,r,a,o,l),Sr=xe(e,"y",zt.y,n,r,a,o,l),Er||Sr}var xt=new Se,_r,Mr,Tr;function zn(e,t,n,r,a,o,l){return typeof t=="number"?xt.setScalar(t):Array.isArray(t)?xt.set(t[0],t[1],t[2]):xt.copy(t),_r=xe(e,"x",xt.x,n,r,a,o,l),Mr=xe(e,"y",xt.y,n,r,a,o,l),Tr=xe(e,"z",xt.z,n,r,a,o,l),_r||Mr||Tr}var gt=new _n,br,Rr,Cr,Ar;function Fs(e,t,n,r,a,o,l){return typeof t=="number"?gt.setScalar(t):Array.isArray(t)?gt.set(t[0],t[1],t[2],t[3]):gt.copy(t),br=xe(e,"x",gt.x,n,r,a,o,l),Rr=xe(e,"y",gt.y,n,r,a,o,l),Cr=xe(e,"z",gt.z,n,r,a,o,l),Ar=xe(e,"w",gt.w,n,r,a,o,l),br||Rr||Cr||Ar}var kt=new la,Ir,Pr,Dr;function Us(e,t,n,r,a,o,l){return Array.isArray(t)?kt.set(t[0],t[1],t[2],t[3]):kt.copy(t),Ir=_t(e,"x",kt.x,n,r,a,o,l),Pr=_t(e,"y",kt.y,n,r,a,o,l),Dr=_t(e,"z",kt.z,n,r,a,o,l),Ir||Pr||Dr}var wt=new en,Lr,Br,Or;function Hs(e,t,n,r,a,o,l){return t instanceof en?wt.copy(t):Array.isArray(t)?wt.setRGB(t[0],t[1],t[2]):wt.set(t),Lr=xe(e,"r",wt.r,n,r,a,o,l),Br=xe(e,"g",wt.g,n,r,a,o,l),Or=xe(e,"b",wt.b,n,r,a,o,l),Lr||Br||Or}var Ve=new bt,rt=new _n,Nr=new _n,Gt=new _n,Fr,Ur,Hr,zr;function En(e,t,n,r,a,o,l){var u=e;Array.isArray(t)?Ve.set(t[0],t[1],t[2],t[3]):Ve.copy(t);var d=e.dot(Ve)>0?1:-1;return Ve.x*=d,Ve.y*=d,Ve.z*=d,Ve.w*=d,Fr=xe(e,"x",Ve.x,n,r,a,o,l),Ur=xe(e,"y",Ve.y,n,r,a,o,l),Hr=xe(e,"z",Ve.z,n,r,a,o,l),zr=xe(e,"w",Ve.w,n,r,a,o,l),rt.set(e.x,e.y,e.z,e.w).normalize(),Nr.set(u.__damp.velocity_x,u.__damp.velocity_y,u.__damp.velocity_z,u.__damp.velocity_w),Gt.copy(rt).multiplyScalar(Nr.dot(rt)/rt.dot(rt)),u.__damp.velocity_x-=Gt.x,u.__damp.velocity_y-=Gt.y,u.__damp.velocity_z-=Gt.z,u.__damp.velocity_w-=Gt.w,e.set(rt.x,rt.y,rt.z,rt.w),Fr||Ur||Hr||zr}var Wt=new ca,kr,Gr,Wr;function zs(e,t,n,r,a,o,l){return Array.isArray(t)?Wt.set(t[0],t[1],t[2]):Wt.copy(t),kr=xe(e,"radius",Wt.radius,n,r,a,o,l),Gr=_t(e,"phi",Wt.phi,n,r,a,o,l),Wr=_t(e,"theta",Wt.theta,n,r,a,o,l),kr||Gr||Wr}var fn=new hi,jr=new Se,Vr=new bt,Zr=new Se,$r,Xr,qr;function ks(e,t,n,r,a,o,l){var u=e;return u.__damp===void 0&&(u.__damp={position:new Se,rotation:new bt,scale:new Se},e.decompose(u.__damp.position,u.__damp.rotation,u.__damp.scale)),Array.isArray(t)?fn.set.apply(fn,gs(t)):fn.copy(t),fn.decompose(jr,Vr,Zr),$r=zn(u.__damp.position,jr,n,r,a,o,l),Xr=En(u.__damp.rotation,Vr,n,r,a,o,l),qr=zn(u.__damp.scale,Zr,n,r,a,o,l),e.compose(u.__damp.position,u.__damp.rotation,u.__damp.scale),$r||Xr||qr}var Yr=Object.freeze({__proto__:null,rsqw:Ts,exp:bi,linear:bs,sine:Rs,cubic:Cs,quint:As,circ:Is,quart:Ps,expo:Ds,damp:xe,dampLookAt:Os,dampAngle:_t,damp2:Ns,damp3:zn,damp4:Fs,dampE:Us,dampC:Hs,dampQ:En,dampS:zs,dampM:ks});const Ri=v.createContext(null);function Gs(){return v.useContext(Ri)}function Ws({eps:e=1e-5,enabled:t=!0,infinite:n,horizontal:r,pages:a=1,distance:o=1,damping:l=.25,maxSpeed:u=1/0,prepend:d=!1,style:h={},children:g}){const{get:y,setEvents:_,gl:B,size:$,invalidate:V,events:k}=We(),[A]=v.useState(()=>document.createElement("div")),[H]=v.useState(()=>document.createElement("div")),[P]=v.useState(()=>document.createElement("div")),q=B.domElement.parentNode,W=v.useRef(0),L=v.useMemo(()=>({el:A,eps:e,fill:H,fixed:P,horizontal:r,damping:l,offset:0,delta:0,scroll:W,pages:a,range(x,F,I=0){const O=x-I,Z=O+F+I*2;return this.offset<O?0:this.offset>Z?1:(this.offset-O)/(Z-O)},curve(x,F,I=0){return Math.sin(this.range(x,F,I)*Math.PI)},visible(x,F,I=0){const O=x-I,Z=O+F+I*2;return this.offset>=O&&this.offset<=Z}}),[e,l,r,a]);v.useEffect(()=>{A.style.position="absolute",A.style.width="100%",A.style.height="100%",A.style[r?"overflowX":"overflowY"]="auto",A.style[r?"overflowY":"overflowX"]="hidden",A.style.top="0px",A.style.left="0px";for(const F in h)A.style[F]=h[F];P.style.position="sticky",P.style.top="0px",P.style.left="0px",P.style.width="100%",P.style.height="100%",P.style.overflow="hidden",A.appendChild(P),H.style.height=r?"100%":`${a*o*100}%`,H.style.width=r?`${a*o*100}%`:"100%",H.style.pointerEvents="none",A.appendChild(H),d?q.prepend(A):q.appendChild(A),A[r?"scrollLeft":"scrollTop"]=1;const w=k.connected||B.domElement;requestAnimationFrame(()=>k.connect==null?void 0:k.connect(A));const x=y().events.compute;return _({compute(F,I){const{left:O,top:Z}=q.getBoundingClientRect(),U=F.clientX-O,j=F.clientY-Z;I.pointer.set(U/I.size.width*2-1,-(j/I.size.height)*2+1),I.raycaster.setFromCamera(I.pointer,I.camera)}}),()=>{q.removeChild(A),_({compute:x}),k.connect==null||k.connect(w)}},[a,o,r,A,H,P,q]),v.useEffect(()=>{if(k.connected===A){const w=$[r?"width":"height"],x=A[r?"scrollWidth":"scrollHeight"],F=x-w;let I=0,O=!0,Z=!0;const U=()=>{if(!(!t||Z)&&(V(),I=A[r?"scrollLeft":"scrollTop"],W.current=I/F,n)){if(!O){if(I>=F){const S=1-L.offset;A[r?"scrollLeft":"scrollTop"]=1,W.current=L.offset=-S,O=!0}else if(I<=0){const S=1+L.offset;A[r?"scrollLeft":"scrollTop"]=x,W.current=L.offset=S,O=!0}}O&&setTimeout(()=>O=!1,40)}};A.addEventListener("scroll",U,{passive:!0}),requestAnimationFrame(()=>Z=!1);const j=S=>A.scrollLeft+=S.deltaY/2;return r&&A.addEventListener("wheel",j,{passive:!0}),()=>{A.removeEventListener("scroll",U),r&&A.removeEventListener("wheel",j)}}},[A,k,$,n,L,V,r,t]);let J=0;return pt((w,x)=>{J=L.offset,Yr.damp(L,"offset",W.current,l,x,u,void 0,e),Yr.damp(L,"delta",Math.abs(J-L.offset),l,x,u,void 0,e),L.delta>e&&V()}),v.createElement(Ri.Provider,{value:L},g)}let jt;function js(){var e;if(jt!==void 0)return jt;try{let t;const n=document.createElement("canvas");return jt=!!(window.WebGL2RenderingContext&&(t=n.getContext("webgl2"))),t&&((e=t.getExtension("WEBGL_lose_context"))==null||e.loseContext()),jt}catch{return jt=!1}}var Ge=Uint8Array,ft=Uint16Array,kn=Uint32Array,Ci=new Ge([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ai=new Ge([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vs=new Ge([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ii=function(e,t){for(var n=new ft(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new kn(n[30]),r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)a[o]=o-n[r]<<5|r;return[n,a]},Pi=Ii(Ci,2),Di=Pi[0],Zs=Pi[1];Di[28]=258,Zs[258]=28;var $s=Ii(Ai,0),Xs=$s[0],Gn=new ft(32768);for(var me=0;me<32768;++me){var lt=(me&43690)>>>1|(me&21845)<<1;lt=(lt&52428)>>>2|(lt&13107)<<2,lt=(lt&61680)>>>4|(lt&3855)<<4,Gn[me]=((lt&65280)>>>8|(lt&255)<<8)>>>1}var qt=function(e,t,n){for(var r=e.length,a=0,o=new ft(t);a<r;++a)++o[e[a]-1];var l=new ft(t);for(a=0;a<t;++a)l[a]=l[a-1]+o[a-1]<<1;var u;if(n){u=new ft(1<<t);var d=15-t;for(a=0;a<r;++a)if(e[a])for(var h=a<<4|e[a],g=t-e[a],y=l[e[a]-1]++<<g,_=y|(1<<g)-1;y<=_;++y)u[Gn[y]>>>d]=h}else for(u=new ft(r),a=0;a<r;++a)e[a]&&(u[a]=Gn[l[e[a]-1]++]>>>15-e[a]);return u},nn=new Ge(288);for(var me=0;me<144;++me)nn[me]=8;for(var me=144;me<256;++me)nn[me]=9;for(var me=256;me<280;++me)nn[me]=7;for(var me=280;me<288;++me)nn[me]=8;var Li=new Ge(32);for(var me=0;me<32;++me)Li[me]=5;var qs=qt(nn,9,1),Ys=qt(Li,5,1),Pn=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Ze=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},Dn=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},Qs=function(e){return(e/8|0)+(e&7&&1)},Ks=function(e,t,n){(n==null||n>e.length)&&(n=e.length);var r=new(e instanceof ft?ft:e instanceof kn?kn:Ge)(n-t);return r.set(e.subarray(t,n)),r},Js=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Ge(0);var a=!t||n,o=!n||n.i;n||(n={}),t||(t=new Ge(r*3));var l=function(ie){var je=t.length;if(ie>je){var _e=new Ge(Math.max(je*2,ie));_e.set(t),t=_e}},u=n.f||0,d=n.p||0,h=n.b||0,g=n.l,y=n.d,_=n.m,B=n.n,$=r*8;do{if(!g){n.f=u=Ze(e,d,1);var V=Ze(e,d+1,3);if(d+=3,V)if(V==1)g=qs,y=Ys,_=9,B=5;else if(V==2){var P=Ze(e,d,31)+257,q=Ze(e,d+10,15)+4,W=P+Ze(e,d+5,31)+1;d+=14;for(var L=new Ge(W),J=new Ge(19),w=0;w<q;++w)J[Vs[w]]=Ze(e,d+w*3,7);d+=q*3;for(var x=Pn(J),F=(1<<x)-1,I=qt(J,x,1),w=0;w<W;){var O=I[Ze(e,d,F)];d+=O&15;var k=O>>>4;if(k<16)L[w++]=k;else{var Z=0,U=0;for(k==16?(U=3+Ze(e,d,3),d+=2,Z=L[w-1]):k==17?(U=3+Ze(e,d,7),d+=3):k==18&&(U=11+Ze(e,d,127),d+=7);U--;)L[w++]=Z}}var j=L.subarray(0,P),S=L.subarray(P);_=Pn(j),B=Pn(S),g=qt(j,_,1),y=qt(S,B,1)}else throw"invalid block type";else{var k=Qs(d)+4,A=e[k-4]|e[k-3]<<8,H=k+A;if(H>r){if(o)throw"unexpected EOF";break}a&&l(h+A),t.set(e.subarray(k,H),h),n.b=h+=A,n.p=d=H*8;continue}if(d>$){if(o)throw"unexpected EOF";break}}a&&l(h+131072);for(var X=(1<<_)-1,le=(1<<B)-1,we=d;;we=d){var Z=g[Dn(e,d)&X],ne=Z>>>4;if(d+=Z&15,d>$){if(o)throw"unexpected EOF";break}if(!Z)throw"invalid length/literal";if(ne<256)t[h++]=ne;else if(ne==256){we=d,g=null;break}else{var Ne=ne-254;if(ne>264){var w=ne-257,re=Ci[w];Ne=Ze(e,d,(1<<re)-1)+Di[w],d+=re}var de=y[Dn(e,d)&le],Re=de>>>4;if(!de)throw"invalid distance";d+=de&15;var S=Xs[Re];if(Re>3){var re=Ai[Re];S+=Dn(e,d)&(1<<re)-1,d+=re}if(d>$){if(o)throw"unexpected EOF";break}a&&l(h+131072);for(var qe=h+Ne;h<qe;h+=4)t[h]=t[h-S],t[h+1]=t[h+1-S],t[h+2]=t[h+2-S],t[h+3]=t[h+3-S];h=qe}}n.l=g,n.p=we,n.b=h,g&&(u=1,n.m=_,n.d=y,n.n=B)}while(!u);return h==t.length?t:Ks(t,0,h)},eo=new Ge(0),to=function(e){if((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(e[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function hn(e,t){return Js((to(e),e.subarray(2,-4)),t)}var no=typeof TextDecoder<"u"&&new TextDecoder,ro=0;try{no.decode(eo,{stream:!0}),ro=1}catch{}const io=e=>e&&e.isCubeTexture;class ao extends Rt{constructor(t,n){var r,a;const o=io(t),u=((a=o?(r=t.image[0])==null?void 0:r.width:t.image.width)!=null?a:1024)/4,d=Math.floor(Math.log2(u)),h=Math.pow(2,d),g=3*Math.max(h,16*7),y=4*h,_=[o?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/g}`,`#define CUBEUV_TEXEL_HEIGHT ${1/y}`,`#define CUBEUV_MAX_MIP ${d}.0`],B=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,$=_.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${pi>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,V={map:{value:t},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},k=new ua(1,16),A=new $e({uniforms:V,fragmentShader:$,vertexShader:B,side:Et});super(k,A)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class so extends mi{constructor(t){super(t),this.type=Be}parse(t){const l=function(w,x){switch(w){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(x||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(x||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(x||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(x||""))}},g=`
`,y=function(w,x,F){x=x||1024;let O=w.pos,Z=-1,U=0,j="",S=String.fromCharCode.apply(null,new Uint16Array(w.subarray(O,O+128)));for(;0>(Z=S.indexOf(g))&&U<x&&O<w.byteLength;)j+=S,U+=S.length,O+=128,S+=String.fromCharCode.apply(null,new Uint16Array(w.subarray(O,O+128)));return-1<Z?(w.pos+=U+Z+1,j+S.slice(0,Z)):!1},_=function(w){const x=/^#\?(\S+)/,F=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,O=/^\s*FORMAT=(\S+)\s*$/,Z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,U={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let j,S;for((w.pos>=w.byteLength||!(j=y(w)))&&l(1,"no header found"),(S=j.match(x))||l(3,"bad initial token"),U.valid|=1,U.programtype=S[1],U.string+=j+`
`;j=y(w),j!==!1;){if(U.string+=j+`
`,j.charAt(0)==="#"){U.comments+=j+`
`;continue}if((S=j.match(F))&&(U.gamma=parseFloat(S[1])),(S=j.match(I))&&(U.exposure=parseFloat(S[1])),(S=j.match(O))&&(U.valid|=2,U.format=S[1]),(S=j.match(Z))&&(U.valid|=4,U.height=parseInt(S[1],10),U.width=parseInt(S[2],10)),U.valid&2&&U.valid&4)break}return U.valid&2||l(3,"missing format specifier"),U.valid&4||l(3,"missing image size specifier"),U},B=function(w,x,F){const I=x;if(I<8||I>32767||w[0]!==2||w[1]!==2||w[2]&128)return new Uint8Array(w);I!==(w[2]<<8|w[3])&&l(3,"wrong scanline width");const O=new Uint8Array(4*x*F);O.length||l(4,"unable to allocate buffer space");let Z=0,U=0;const j=4*I,S=new Uint8Array(4),X=new Uint8Array(j);let le=F;for(;le>0&&U<w.byteLength;){U+4>w.byteLength&&l(1),S[0]=w[U++],S[1]=w[U++],S[2]=w[U++],S[3]=w[U++],(S[0]!=2||S[1]!=2||(S[2]<<8|S[3])!=I)&&l(3,"bad rgbe scanline format");let we=0,ne;for(;we<j&&U<w.byteLength;){ne=w[U++];const re=ne>128;if(re&&(ne-=128),(ne===0||we+ne>j)&&l(3,"bad scanline data"),re){const de=w[U++];for(let Re=0;Re<ne;Re++)X[we++]=de}else X.set(w.subarray(U,U+ne),we),we+=ne,U+=ne}const Ne=I;for(let re=0;re<Ne;re++){let de=0;O[Z]=X[re+de],de+=I,O[Z+1]=X[re+de],de+=I,O[Z+2]=X[re+de],de+=I,O[Z+3]=X[re+de],Z+=4}le--}return O},$=function(w,x,F,I){const O=w[x+3],Z=Math.pow(2,O-128)/255;F[I+0]=w[x+0]*Z,F[I+1]=w[x+1]*Z,F[I+2]=w[x+2]*Z,F[I+3]=1},V=function(w,x,F,I){const O=w[x+3],Z=Math.pow(2,O-128)/255;F[I+0]=St.toHalfFloat(Math.min(w[x+0]*Z,65504)),F[I+1]=St.toHalfFloat(Math.min(w[x+1]*Z,65504)),F[I+2]=St.toHalfFloat(Math.min(w[x+2]*Z,65504)),F[I+3]=St.toHalfFloat(1)},k=new Uint8Array(t);k.pos=0;const A=_(k),H=A.width,P=A.height,q=B(k.subarray(k.pos),H,P);let W,L,J;switch(this.type){case Ke:J=q.length/4;const w=new Float32Array(J*4);for(let F=0;F<J;F++)$(q,F*4,w,F*4);W=w,L=Ke;break;case Be:J=q.length/4;const x=new Uint16Array(J*4);for(let F=0;F<J;F++)V(q,F*4,x,F*4);W=x,L=Be;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:H,height:P,data:W,header:A.string,gamma:A.gamma,exposure:A.exposure,type:L}}setDataType(t){return this.type=t,this}load(t,n,r,a){function o(l,u){switch(l.type){case Ke:case Be:"colorSpace"in l?l.colorSpace="srgb-linear":l.encoding=3e3,l.minFilter=Pe,l.magFilter=Pe,l.generateMipmaps=!1,l.flipY=!0;break}n&&n(l,u)}return super.load(t,o,r,a)}}const Vt=pi>=152;class oo extends mi{constructor(t){super(t),this.type=Be}parse(t){const x=Math.pow(2.7182818,2.2);function F(i,s){for(var c=0,f=0;f<65536;++f)(f==0||i[f>>3]&1<<(f&7))&&(s[c++]=f);for(var p=c-1;c<65536;)s[c++]=0;return p}function I(i){for(var s=0;s<16384;s++)i[s]={},i[s].len=0,i[s].lit=0,i[s].p=null}const O={l:0,c:0,lc:0};function Z(i,s,c,f,p){for(;c<i;)s=s<<8|sr(f,p),c+=8;c-=i,O.l=s>>c&(1<<i)-1,O.c=s,O.lc=c}const U=new Array(59);function j(i){for(var s=0;s<=58;++s)U[s]=0;for(var s=0;s<65537;++s)U[i[s]]+=1;for(var c=0,s=58;s>0;--s){var f=c+U[s]>>1;U[s]=c,c=f}for(var s=0;s<65537;++s){var p=i[s];p>0&&(i[s]=p|U[p]++<<6)}}function S(i,s,c,f,p,m,M){for(var E=c,R=0,b=0;p<=m;p++){if(E.value-c.value>f)return!1;Z(6,R,b,i,E);var C=O.l;if(R=O.c,b=O.lc,M[p]=C,C==63){if(E.value-c.value>f)throw"Something wrong with hufUnpackEncTable";Z(8,R,b,i,E);var T=O.l+6;if(R=O.c,b=O.lc,p+T>m+1)throw"Something wrong with hufUnpackEncTable";for(;T--;)M[p++]=0;p--}else if(C>=59){var T=C-59+2;if(p+T>m+1)throw"Something wrong with hufUnpackEncTable";for(;T--;)M[p++]=0;p--}}j(M)}function X(i){return i&63}function le(i){return i>>6}function we(i,s,c,f){for(;s<=c;s++){var p=le(i[s]),m=X(i[s]);if(p>>m)throw"Invalid table entry";if(m>14){var M=f[p>>m-14];if(M.len)throw"Invalid table entry";if(M.lit++,M.p){var E=M.p;M.p=new Array(M.lit);for(var R=0;R<M.lit-1;++R)M.p[R]=E[R]}else M.p=new Array(1);M.p[M.lit-1]=s}else if(m)for(var b=0,R=1<<14-m;R>0;R--){var M=f[(p<<14-m)+b];if(M.len||M.p)throw"Invalid table entry";M.len=m,M.lit=s,b++}}return!0}const ne={c:0,lc:0};function Ne(i,s,c,f){i=i<<8|sr(c,f),s+=8,ne.c=i,ne.lc=s}const re={c:0,lc:0};function de(i,s,c,f,p,m,M,E,R,b){if(i==s){f<8&&(Ne(c,f,p,M),c=ne.c,f=ne.lc),f-=8;var C=c>>f,C=new Uint8Array([C])[0];if(R.value+C>b)return!1;for(var T=E[R.value-1];C-- >0;)E[R.value++]=T}else if(R.value<b)E[R.value++]=i;else return!1;re.c=c,re.lc=f}function Re(i){return i&65535}function qe(i){var s=Re(i);return s>32767?s-65536:s}const ie={a:0,b:0};function je(i,s){var c=qe(i),f=qe(s),p=f,m=c+(p&1)+(p>>1),M=m,E=m-p;ie.a=M,ie.b=E}function _e(i,s){var c=Re(i),f=Re(s),p=c-(f>>1)&65535,m=f+p-32768&65535;ie.a=m,ie.b=p}function rn(i,s,c,f,p,m,M){for(var E=M<16384,R=c>p?p:c,b=1,C;b<=R;)b<<=1;for(b>>=1,C=b,b>>=1;b>=1;){for(var T=0,ge=T+m*(p-C),z=m*b,G=m*C,Y=f*b,Q=f*C,ce,fe,ye,Ae;T<=ge;T+=G){for(var he=T,Ye=T+f*(c-C);he<=Ye;he+=Q){var pe=he+Y,Ee=he+z,nt=Ee+Y;E?(je(i[he+s],i[Ee+s]),ce=ie.a,ye=ie.b,je(i[pe+s],i[nt+s]),fe=ie.a,Ae=ie.b,je(ce,fe),i[he+s]=ie.a,i[pe+s]=ie.b,je(ye,Ae),i[Ee+s]=ie.a,i[nt+s]=ie.b):(_e(i[he+s],i[Ee+s]),ce=ie.a,ye=ie.b,_e(i[pe+s],i[nt+s]),fe=ie.a,Ae=ie.b,_e(ce,fe),i[he+s]=ie.a,i[pe+s]=ie.b,_e(ye,Ae),i[Ee+s]=ie.a,i[nt+s]=ie.b)}if(c&b){var Ee=he+z;E?je(i[he+s],i[Ee+s]):_e(i[he+s],i[Ee+s]),ce=ie.a,i[Ee+s]=ie.b,i[he+s]=ce}}if(p&b)for(var he=T,Ye=T+f*(c-C);he<=Ye;he+=Q){var pe=he+Y;E?je(i[he+s],i[pe+s]):_e(i[he+s],i[pe+s]),ce=ie.a,i[pe+s]=ie.b,i[he+s]=ce}C=b,b>>=1}return T}function Ce(i,s,c,f,p,m,M,E,R,b){for(var C=0,T=0,ge=E,z=Math.trunc(p.value+(m+7)/8);p.value<z;)for(Ne(C,T,c,p),C=ne.c,T=ne.lc;T>=14;){var G=C>>T-14&16383,Y=s[G];if(Y.len)T-=Y.len,de(Y.lit,M,C,T,c,f,p,R,b,ge),C=re.c,T=re.lc;else{if(!Y.p)throw"hufDecode issues";var Q;for(Q=0;Q<Y.lit;Q++){for(var ce=X(i[Y.p[Q]]);T<ce&&p.value<z;)Ne(C,T,c,p),C=ne.c,T=ne.lc;if(T>=ce&&le(i[Y.p[Q]])==(C>>T-ce&(1<<ce)-1)){T-=ce,de(Y.p[Q],M,C,T,c,f,p,R,b,ge),C=re.c,T=re.lc;break}}if(Q==Y.lit)throw"hufDecode issues"}}var fe=8-m&7;for(C>>=fe,T-=fe;T>0;){var Y=s[C<<14-T&16383];if(Y.len)T-=Y.len,de(Y.lit,M,C,T,c,f,p,R,b,ge),C=re.c,T=re.lc;else throw"hufDecode issues"}return!0}function oe(i,s,c,f,p,m){var M={value:0},E=c.value,R=Ie(s,c),b=Ie(s,c);c.value+=4;var C=Ie(s,c);if(c.value+=4,R<0||R>=65537||b<0||b>=65537)throw"Something wrong with HUF_ENCSIZE";var T=new Array(65537),ge=new Array(16384);I(ge);var z=f-(c.value-E);if(S(i,s,c,z,R,b,T),C>8*(f-(c.value-E)))throw"Something wrong with hufUncompress";we(T,R,b,ge),Ce(T,ge,i,s,c,C,b,m,p,M)}function Je(i,s,c){for(var f=0;f<c;++f)s[f]=i[s[f]]}function Fe(i){for(var s=1;s<i.length;s++){var c=i[s-1]+i[s]-128;i[s]=c}}function st(i,s){for(var c=0,f=Math.floor((i.length+1)/2),p=0,m=i.length-1;!(p>m||(s[p++]=i[c++],p>m));)s[p++]=i[f++]}function mt(i){for(var s=i.byteLength,c=new Array,f=0,p=new DataView(i);s>0;){var m=p.getInt8(f++);if(m<0){var M=-m;s-=M+1;for(var E=0;E<M;E++)c.push(p.getUint8(f++))}else{var M=m;s-=2;for(var R=p.getUint8(f++),E=0;E<M+1;E++)c.push(R)}}return c}function Tn(i,s,c,f,p,m){var pe=new DataView(m.buffer),M=c[i.idx[0]].width,E=c[i.idx[0]].height,R=3,b=Math.floor(M/8),C=Math.ceil(M/8),T=Math.ceil(E/8),ge=M-(C-1)*8,z=E-(T-1)*8,G={value:0},Y=new Array(R),Q=new Array(R),ce=new Array(R),fe=new Array(R),ye=new Array(R);for(let ue=0;ue<R;++ue)ye[ue]=s[i.idx[ue]],Y[ue]=ue<1?0:Y[ue-1]+C*T,Q[ue]=new Float32Array(64),ce[ue]=new Uint16Array(64),fe[ue]=new Uint16Array(C*64);for(let ue=0;ue<T;++ue){var Ae=8;ue==T-1&&(Ae=z);var he=8;for(let ve=0;ve<C;++ve){ve==C-1&&(he=ge);for(let se=0;se<R;++se)ce[se].fill(0),ce[se][0]=p[Y[se]++],et(G,f,ce[se]),an(ce[se],Q[se]),It(Q[se]);sn(Q);for(let se=0;se<R;++se)bn(Q[se],fe[se],ve*64)}let Te=0;for(let ve=0;ve<R;++ve){const se=c[i.idx[ve]].type;for(let ze=8*ue;ze<8*ue+Ae;++ze){Te=ye[ve][ze];for(let vt=0;vt<b;++vt){const De=vt*64+(ze&7)*8;pe.setUint16(Te+0*2*se,fe[ve][De+0],!0),pe.setUint16(Te+1*2*se,fe[ve][De+1],!0),pe.setUint16(Te+2*2*se,fe[ve][De+2],!0),pe.setUint16(Te+3*2*se,fe[ve][De+3],!0),pe.setUint16(Te+4*2*se,fe[ve][De+4],!0),pe.setUint16(Te+5*2*se,fe[ve][De+5],!0),pe.setUint16(Te+6*2*se,fe[ve][De+6],!0),pe.setUint16(Te+7*2*se,fe[ve][De+7],!0),Te+=8*2*se}}if(b!=C)for(let ze=8*ue;ze<8*ue+Ae;++ze){const vt=ye[ve][ze]+8*b*2*se,De=b*64+(ze&7)*8;for(let ot=0;ot<he;++ot)pe.setUint16(vt+ot*2*se,fe[ve][De+ot],!0)}}}for(var Ye=new Uint16Array(M),pe=new DataView(m.buffer),Ee=0;Ee<R;++Ee){c[i.idx[Ee]].decoded=!0;var nt=c[i.idx[Ee]].type;if(c[Ee].type==2)for(var Nt=0;Nt<E;++Nt){const ue=ye[Ee][Nt];for(var He=0;He<M;++He)Ye[He]=pe.getUint16(ue+He*2*nt,!0);for(var He=0;He<M;++He)pe.setFloat32(ue+He*2*nt,D(Ye[He]),!0)}}}function et(i,s,c){for(var f,p=1;p<64;)f=s[i.value],f==65280?p=64:f>>8==255?p+=f&255:(c[p]=f,p++),i.value++}function an(i,s){s[0]=D(i[0]),s[1]=D(i[1]),s[2]=D(i[5]),s[3]=D(i[6]),s[4]=D(i[14]),s[5]=D(i[15]),s[6]=D(i[27]),s[7]=D(i[28]),s[8]=D(i[2]),s[9]=D(i[4]),s[10]=D(i[7]),s[11]=D(i[13]),s[12]=D(i[16]),s[13]=D(i[26]),s[14]=D(i[29]),s[15]=D(i[42]),s[16]=D(i[3]),s[17]=D(i[8]),s[18]=D(i[12]),s[19]=D(i[17]),s[20]=D(i[25]),s[21]=D(i[30]),s[22]=D(i[41]),s[23]=D(i[43]),s[24]=D(i[9]),s[25]=D(i[11]),s[26]=D(i[18]),s[27]=D(i[24]),s[28]=D(i[31]),s[29]=D(i[40]),s[30]=D(i[44]),s[31]=D(i[53]),s[32]=D(i[10]),s[33]=D(i[19]),s[34]=D(i[23]),s[35]=D(i[32]),s[36]=D(i[39]),s[37]=D(i[45]),s[38]=D(i[52]),s[39]=D(i[54]),s[40]=D(i[20]),s[41]=D(i[22]),s[42]=D(i[33]),s[43]=D(i[38]),s[44]=D(i[46]),s[45]=D(i[51]),s[46]=D(i[55]),s[47]=D(i[60]),s[48]=D(i[21]),s[49]=D(i[34]),s[50]=D(i[37]),s[51]=D(i[47]),s[52]=D(i[50]),s[53]=D(i[56]),s[54]=D(i[59]),s[55]=D(i[61]),s[56]=D(i[35]),s[57]=D(i[36]),s[58]=D(i[48]),s[59]=D(i[49]),s[60]=D(i[57]),s[61]=D(i[58]),s[62]=D(i[62]),s[63]=D(i[63])}function It(i){const s=.5*Math.cos(.7853975),c=.5*Math.cos(3.14159/16),f=.5*Math.cos(3.14159/8),p=.5*Math.cos(3*3.14159/16),m=.5*Math.cos(5*3.14159/16),M=.5*Math.cos(3*3.14159/8),E=.5*Math.cos(7*3.14159/16);for(var R=new Array(4),b=new Array(4),C=new Array(4),T=new Array(4),ge=0;ge<8;++ge){var z=ge*8;R[0]=f*i[z+2],R[1]=M*i[z+2],R[2]=f*i[z+6],R[3]=M*i[z+6],b[0]=c*i[z+1]+p*i[z+3]+m*i[z+5]+E*i[z+7],b[1]=p*i[z+1]-E*i[z+3]-c*i[z+5]-m*i[z+7],b[2]=m*i[z+1]-c*i[z+3]+E*i[z+5]+p*i[z+7],b[3]=E*i[z+1]-m*i[z+3]+p*i[z+5]-c*i[z+7],C[0]=s*(i[z+0]+i[z+4]),C[3]=s*(i[z+0]-i[z+4]),C[1]=R[0]+R[3],C[2]=R[1]-R[2],T[0]=C[0]+C[1],T[1]=C[3]+C[2],T[2]=C[3]-C[2],T[3]=C[0]-C[1],i[z+0]=T[0]+b[0],i[z+1]=T[1]+b[1],i[z+2]=T[2]+b[2],i[z+3]=T[3]+b[3],i[z+4]=T[3]-b[3],i[z+5]=T[2]-b[2],i[z+6]=T[1]-b[1],i[z+7]=T[0]-b[0]}for(var G=0;G<8;++G)R[0]=f*i[16+G],R[1]=M*i[16+G],R[2]=f*i[48+G],R[3]=M*i[48+G],b[0]=c*i[8+G]+p*i[24+G]+m*i[40+G]+E*i[56+G],b[1]=p*i[8+G]-E*i[24+G]-c*i[40+G]-m*i[56+G],b[2]=m*i[8+G]-c*i[24+G]+E*i[40+G]+p*i[56+G],b[3]=E*i[8+G]-m*i[24+G]+p*i[40+G]-c*i[56+G],C[0]=s*(i[G]+i[32+G]),C[3]=s*(i[G]-i[32+G]),C[1]=R[0]+R[3],C[2]=R[1]-R[2],T[0]=C[0]+C[1],T[1]=C[3]+C[2],T[2]=C[3]-C[2],T[3]=C[0]-C[1],i[0+G]=T[0]+b[0],i[8+G]=T[1]+b[1],i[16+G]=T[2]+b[2],i[24+G]=T[3]+b[3],i[32+G]=T[3]-b[3],i[40+G]=T[2]-b[2],i[48+G]=T[1]-b[1],i[56+G]=T[0]-b[0]}function sn(i){for(var s=0;s<64;++s){var c=i[0][s],f=i[1][s],p=i[2][s];i[0][s]=c+1.5747*p,i[1][s]=c-.1873*f-.4682*p,i[2][s]=c+1.8556*f}}function bn(i,s,c){for(var f=0;f<64;++f)s[c+f]=St.toHalfFloat(Rn(i[f]))}function Rn(i){return i<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(x,Math.abs(i)-1)}function on(i){return new DataView(i.array.buffer,i.offset.value,i.size)}function Cn(i){var s=i.viewer.buffer.slice(i.offset.value,i.offset.value+i.size),c=new Uint8Array(mt(s)),f=new Uint8Array(c.length);return Fe(c),st(c,f),new DataView(f.buffer)}function Pt(i){var s=i.array.slice(i.offset.value,i.offset.value+i.size),c=hn(s),f=new Uint8Array(c.length);return Fe(c),st(c,f),new DataView(f.buffer)}function An(i){for(var s=i.viewer,c={value:i.offset.value},f=new Uint16Array(i.width*i.scanlineBlockSize*(i.channels*i.type)),p=new Uint8Array(8192),m=0,M=new Array(i.channels),E=0;E<i.channels;E++)M[E]={},M[E].start=m,M[E].end=M[E].start,M[E].nx=i.width,M[E].ny=i.lines,M[E].size=i.type,m+=M[E].nx*M[E].ny*M[E].size;var R=Lt(s,c),b=Lt(s,c);if(b>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(R<=b)for(var E=0;E<b-R+1;E++)p[E+R]=yt(s,c);var C=new Uint16Array(65536),T=F(p,C),ge=Ie(s,c);oe(i.array,s,c,ge,f,m);for(var E=0;E<i.channels;++E)for(var z=M[E],G=0;G<M[E].size;++G)rn(f,z.start+G,z.nx,z.size,z.ny,z.nx*z.size,T);Je(C,f,m);for(var Y=0,Q=new Uint8Array(f.buffer.byteLength),ce=0;ce<i.lines;ce++)for(var fe=0;fe<i.channels;fe++){var z=M[fe],ye=z.nx*z.size,Ae=new Uint8Array(f.buffer,z.end*2,ye*2);Q.set(Ae,Y),Y+=ye*2,z.end+=ye}return new DataView(Q.buffer)}function tt(i){var s=i.array.slice(i.offset.value,i.offset.value+i.size),c=hn(s);const f=i.lines*i.channels*i.width,p=i.type==1?new Uint16Array(f):new Uint32Array(f);let m=0,M=0;const E=new Array(4);for(let R=0;R<i.lines;R++)for(let b=0;b<i.channels;b++){let C=0;switch(i.type){case 1:E[0]=m,E[1]=E[0]+i.width,m=E[1]+i.width;for(let T=0;T<i.width;++T){const ge=c[E[0]++]<<8|c[E[1]++];C+=ge,p[M]=C,M++}break;case 2:E[0]=m,E[1]=E[0]+i.width,E[2]=E[1]+i.width,m=E[2]+i.width;for(let T=0;T<i.width;++T){const ge=c[E[0]++]<<24|c[E[1]++]<<16|c[E[2]++]<<8;C+=ge,p[M]=C,M++}break}}return new DataView(p.buffer)}function ar(i){var s=i.viewer,c={value:i.offset.value},f=new Uint8Array(i.width*i.lines*(i.channels*i.type*2)),p={version:Ue(s,c),unknownUncompressedSize:Ue(s,c),unknownCompressedSize:Ue(s,c),acCompressedSize:Ue(s,c),dcCompressedSize:Ue(s,c),rleCompressedSize:Ue(s,c),rleUncompressedSize:Ue(s,c),rleRawSize:Ue(s,c),totalAcUncompressedCount:Ue(s,c),totalDcUncompressedCount:Ue(s,c),acCompression:Ue(s,c)};if(p.version<2)throw"EXRLoader.parse: "+Ot.compression+" version "+p.version+" is unsupported";for(var m=new Array,M=Lt(s,c)-2;M>0;){var E=ln(s.buffer,c),R=yt(s,c),b=R>>2&3,C=(R>>4)-1,T=new Int8Array([C])[0],ge=yt(s,c);m.push({name:E,index:T,type:ge,compression:b}),M-=E.length+3}for(var z=Ot.channels,G=new Array(i.channels),Y=0;Y<i.channels;++Y){var Q=G[Y]={},ce=z[Y];Q.name=ce.name,Q.compression=0,Q.decoded=!1,Q.type=ce.pixelType,Q.pLinear=ce.pLinear,Q.width=i.width,Q.height=i.lines}for(var fe={idx:new Array(3)},ye=0;ye<i.channels;++ye)for(var Q=G[ye],Y=0;Y<m.length;++Y){var Ae=m[Y];Q.name==Ae.name&&(Q.compression=Ae.compression,Ae.index>=0&&(fe.idx[Ae.index]=ye),Q.offset=ye)}if(p.acCompressedSize>0)switch(p.acCompression){case 0:var pe=new Uint16Array(p.totalAcUncompressedCount);oe(i.array,s,c,p.acCompressedSize,pe,p.totalAcUncompressedCount);break;case 1:var he=i.array.slice(c.value,c.value+p.totalAcUncompressedCount),Ye=hn(he),pe=new Uint16Array(Ye.buffer);c.value+=p.totalAcUncompressedCount;break}if(p.dcCompressedSize>0){var Ee={array:i.array,offset:c,size:p.dcCompressedSize},nt=new Uint16Array(Pt(Ee).buffer);c.value+=p.dcCompressedSize}if(p.rleRawSize>0){var he=i.array.slice(c.value,c.value+p.rleCompressedSize),Ye=hn(he),Nt=mt(Ye.buffer);c.value+=p.rleCompressedSize}for(var He=0,ue=new Array(G.length),Y=0;Y<ue.length;++Y)ue[Y]=new Array;for(var Te=0;Te<i.lines;++Te)for(var ve=0;ve<G.length;++ve)ue[ve].push(He),He+=G[ve].width*i.type*2;Tn(fe,ue,G,pe,nt,f);for(var Y=0;Y<G.length;++Y){var Q=G[Y];if(!Q.decoded)switch(Q.compression){case 2:for(var se=0,ze=0,Te=0;Te<i.lines;++Te){for(var vt=ue[Y][se],De=0;De<Q.width;++De){for(var ot=0;ot<2*Q.type;++ot)f[vt++]=Nt[ze+ot*Q.width*Q.height];ze++}se++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(f.buffer)}function ln(i,s){for(var c=new Uint8Array(i),f=0;c[s.value+f]!=0;)f+=1;var p=new TextDecoder().decode(c.slice(s.value,s.value+f));return s.value=s.value+f+1,p}function ji(i,s,c){var f=new TextDecoder().decode(new Uint8Array(i).slice(s.value,s.value+c));return s.value=s.value+c,f}function Vi(i,s){var c=Dt(i,s),f=Ie(i,s);return[c,f]}function Zi(i,s){var c=Ie(i,s),f=Ie(i,s);return[c,f]}function Dt(i,s){var c=i.getInt32(s.value,!0);return s.value=s.value+4,c}function Ie(i,s){var c=i.getUint32(s.value,!0);return s.value=s.value+4,c}function sr(i,s){var c=i[s.value];return s.value=s.value+1,c}function yt(i,s){var c=i.getUint8(s.value);return s.value=s.value+1,c}const Ue=function(i,s){let c;return"getBigInt64"in DataView.prototype?c=Number(i.getBigInt64(s.value,!0)):c=i.getUint32(s.value+4,!0)+Number(i.getUint32(s.value,!0)<<32),s.value+=8,c};function Me(i,s){var c=i.getFloat32(s.value,!0);return s.value+=4,c}function $i(i,s){return St.toHalfFloat(Me(i,s))}function D(i){var s=(i&31744)>>10,c=i&1023;return(i>>15?-1:1)*(s?s===31?c?NaN:1/0:Math.pow(2,s-15)*(1+c/1024):6103515625e-14*(c/1024))}function Lt(i,s){var c=i.getUint16(s.value,!0);return s.value+=2,c}function Xi(i,s){return D(Lt(i,s))}function qi(i,s,c,f){for(var p=c.value,m=[];c.value<p+f-1;){var M=ln(s,c),E=Dt(i,c),R=yt(i,c);c.value+=3;var b=Dt(i,c),C=Dt(i,c);m.push({name:M,pixelType:E,pLinear:R,xSampling:b,ySampling:C})}return c.value+=1,m}function Yi(i,s){var c=Me(i,s),f=Me(i,s),p=Me(i,s),m=Me(i,s),M=Me(i,s),E=Me(i,s),R=Me(i,s),b=Me(i,s);return{redX:c,redY:f,greenX:p,greenY:m,blueX:M,blueY:E,whiteX:R,whiteY:b}}function Qi(i,s){var c=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],f=yt(i,s);return c[f]}function Ki(i,s){var c=Ie(i,s),f=Ie(i,s),p=Ie(i,s),m=Ie(i,s);return{xMin:c,yMin:f,xMax:p,yMax:m}}function Ji(i,s){var c=["INCREASING_Y"],f=yt(i,s);return c[f]}function ea(i,s){var c=Me(i,s),f=Me(i,s);return[c,f]}function ta(i,s){var c=Me(i,s),f=Me(i,s),p=Me(i,s);return[c,f,p]}function na(i,s,c,f,p){if(f==="string"||f==="stringvector"||f==="iccProfile")return ji(s,c,p);if(f==="chlist")return qi(i,s,c,p);if(f==="chromaticities")return Yi(i,c);if(f==="compression")return Qi(i,c);if(f==="box2i")return Ki(i,c);if(f==="lineOrder")return Ji(i,c);if(f==="float")return Me(i,c);if(f==="v2f")return ea(i,c);if(f==="v3f")return ta(i,c);if(f==="int")return Dt(i,c);if(f==="rational")return Vi(i,c);if(f==="timecode")return Zi(i,c);if(f==="preview")return c.value+=p,"skipped";c.value+=p}function ra(i,s,c){const f={};if(i.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";f.version=i.getUint8(4);const p=i.getUint8(5);f.spec={singleTile:!!(p&2),longName:!!(p&4),deepFormat:!!(p&8),multiPart:!!(p&16)},c.value=8;for(var m=!0;m;){var M=ln(s,c);if(M==0)m=!1;else{var E=ln(s,c),R=Ie(i,c),b=na(i,s,c,E,R);b===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${E}'.`):f[M]=b}}if(p&-5)throw console.error("EXRHeader:",f),"THREE.EXRLoader: provided file is currently unsupported.";return f}function ia(i,s,c,f,p){const m={size:0,viewer:s,array:c,offset:f,width:i.dataWindow.xMax-i.dataWindow.xMin+1,height:i.dataWindow.yMax-i.dataWindow.yMin+1,channels:i.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:i.channels[0].pixelType,uncompress:null,getter:null,format:null,[Vt?"colorSpace":"encoding"]:null};switch(i.compression){case"NO_COMPRESSION":m.lines=1,m.uncompress=on;break;case"RLE_COMPRESSION":m.lines=1,m.uncompress=Cn;break;case"ZIPS_COMPRESSION":m.lines=1,m.uncompress=Pt;break;case"ZIP_COMPRESSION":m.lines=16,m.uncompress=Pt;break;case"PIZ_COMPRESSION":m.lines=32,m.uncompress=An;break;case"PXR24_COMPRESSION":m.lines=16,m.uncompress=tt;break;case"DWAA_COMPRESSION":m.lines=32,m.uncompress=ar;break;case"DWAB_COMPRESSION":m.lines=256,m.uncompress=ar;break;default:throw"EXRLoader.parse: "+i.compression+" is unsupported"}if(m.scanlineBlockSize=m.lines,m.type==1)switch(p){case Ke:m.getter=Xi,m.inputSize=2;break;case Be:m.getter=Lt,m.inputSize=2;break}else if(m.type==2)switch(p){case Ke:m.getter=Me,m.inputSize=4;break;case Be:m.getter=$i,m.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+m.type+" for "+i.compression+".";m.blockCount=(i.dataWindow.yMax+1)/m.scanlineBlockSize;for(var M=0;M<m.blockCount;M++)Ue(s,f);m.outputChannels=m.channels==3?4:m.channels;const E=m.width*m.height*m.outputChannels;switch(p){case Ke:m.byteArray=new Float32Array(E),m.channels<m.outputChannels&&m.byteArray.fill(1,0,E);break;case Be:m.byteArray=new Uint16Array(E),m.channels<m.outputChannels&&m.byteArray.fill(15360,0,E);break;default:console.error("THREE.EXRLoader: unsupported type: ",p);break}return m.bytesPerLine=m.width*m.inputSize*m.channels,m.outputChannels==4?m.format=Qt:m.format=da,Vt?m.colorSpace="srgb-linear":m.encoding=3e3,m}const cn=new DataView(t),aa=new Uint8Array(t),Bt={value:0},Ot=ra(cn,t,Bt),ee=ia(Ot,cn,aa,Bt,this.type),or={value:0},sa={R:0,G:1,B:2,A:3,Y:0};for(let i=0;i<ee.height/ee.scanlineBlockSize;i++){const s=Ie(cn,Bt);ee.size=Ie(cn,Bt),ee.lines=s+ee.scanlineBlockSize>ee.height?ee.height-s:ee.scanlineBlockSize;const f=ee.size<ee.lines*ee.bytesPerLine?ee.uncompress(ee):on(ee);Bt.value+=ee.size;for(let p=0;p<ee.scanlineBlockSize;p++){const m=p+i*ee.scanlineBlockSize;if(m>=ee.height)break;for(let M=0;M<ee.channels;M++){const E=sa[Ot.channels[M].name];for(let R=0;R<ee.width;R++){or.value=(p*(ee.channels*ee.width)+M*ee.width+R)*ee.inputSize;const b=(ee.height-1-m)*(ee.width*ee.outputChannels)+R*ee.outputChannels+E;ee.byteArray[b]=ee.getter(f,or)}}}}return{header:Ot,width:ee.width,height:ee.height,data:ee.byteArray,format:ee.format,[Vt?"colorSpace":"encoding"]:ee[Vt?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,n,r,a){function o(l,u){Vt?l.colorSpace=u.colorSpace:l.encoding=u.encoding,l.minFilter=Pe,l.magFilter=Pe,l.generateMipmaps=!1,l.flipY=!1,n&&n(l,u)}return super.load(t,o,r,a)}}function lo(e,t,...n){const r=v.useRef(),a=We(o=>o.scene);return v.useLayoutEffect(()=>{let o;if(e&&e!=null&&e.current&&t&&(r.current=o=new t(e.current,...n)),o)return o.traverse(l=>l.raycast=()=>null),a.add(o),()=>{r.current=void 0,a.remove(o),o.dispose==null||o.dispose()}},[a,t,e,...n]),pt(()=>{var o;return void((o=r.current)==null||o.update==null?void 0:o.update())}),r}function co(e,t){const n=v.useRef(),[r]=v.useState(()=>t?t instanceof Fn?{current:t}:t:n),[a]=v.useState(()=>new fa(void 0));v.useLayoutEffect(()=>{t&&(r.current=t instanceof Fn?t:t.current),a._root=r.current});const o=v.useRef({}),l=v.useMemo(()=>{const u={};return e.forEach(d=>Object.defineProperty(u,d.name,{enumerable:!0,get(){if(r.current)return o.current[d.name]||(o.current[d.name]=a.clipAction(d,r.current))},configurable:!0})),{ref:r,clips:e,actions:u,names:e.map(d=>d.name),mixer:a}},[e]);return pt((u,d)=>a.update(d)),v.useEffect(()=>{const u=r.current;return()=>{o.current={},a.stopAllAction(),Object.values(l.actions).forEach(d=>{u&&a.uncacheAction(d,u)})}},[e]),l}const uo=3e3,fo=3001,Bi=(e,t,n)=>{let r;switch(e){case ht:r=new Uint8ClampedArray(t*n*4);break;case Be:r=new Uint16Array(t*n*4);break;case gi:r=new Uint32Array(t*n*4);break;case ga:r=new Int8Array(t*n*4);break;case va:r=new Int16Array(t*n*4);break;case ma:r=new Int32Array(t*n*4);break;case Ke:r=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return r};let pn;const ho=(e,t,n,r)=>{if(pn!==void 0)return pn;const a=new Xe(1,1,r);t.setRenderTarget(a);const o=new Rt(new vi,new yi({color:16777215}));t.render(o,n),t.setRenderTarget(null);const l=Bi(e,a.width,a.height);return t.readRenderTargetPixels(a,0,0,a.width,a.height,l),a.dispose(),o.geometry.dispose(),o.material.dispose(),pn=l[0]!==0,pn};class Qn{constructor(t){var n,r,a,o,l,u,d,h,g,y,_,B,$,V,k,A;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(P){throw this._renderer.setRenderTarget(null),P}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const H={format:Qt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=t.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(r=t.renderTargetOptions)===null||r===void 0?void 0:r.anisotropy:1,generateMipmaps:((a=t.renderTargetOptions)===null||a===void 0?void 0:a.generateMipmaps)!==void 0?(o=t.renderTargetOptions)===null||o===void 0?void 0:o.generateMipmaps:!1,magFilter:((l=t.renderTargetOptions)===null||l===void 0?void 0:l.magFilter)!==void 0?(u=t.renderTargetOptions)===null||u===void 0?void 0:u.magFilter:Pe,minFilter:((d=t.renderTargetOptions)===null||d===void 0?void 0:d.minFilter)!==void 0?(h=t.renderTargetOptions)===null||h===void 0?void 0:h.minFilter:Pe,samples:((g=t.renderTargetOptions)===null||g===void 0?void 0:g.samples)!==void 0?(y=t.renderTargetOptions)===null||y===void 0?void 0:y.samples:void 0,wrapS:((_=t.renderTargetOptions)===null||_===void 0?void 0:_.wrapS)!==void 0?(B=t.renderTargetOptions)===null||B===void 0?void 0:B.wrapS:ut,wrapT:(($=t.renderTargetOptions)===null||$===void 0?void 0:$.wrapT)!==void 0?(V=t.renderTargetOptions)===null||V===void 0?void 0:V.wrapT:ut};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=Qn.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new yn,this._camera=new Vn,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!ho(this._type,this._renderer,this._camera,H)){let P;switch(this._type){case Be:P=this._renderer.extensions.has("EXT_color_buffer_float")?Ke:void 0;break}P!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ke}`),this._type=P):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Rt(new vi,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Xe(this.width,this.height,H),this._renderTarget.texture.mapping=((k=t.renderTargetOptions)===null||k===void 0?void 0:k.mapping)!==void 0?(A=t.renderTargetOptions)===null||A===void 0?void 0:A.mapping:xn}static instantiateRenderer(){const t=new ha;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Bi(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const n=new pa(this.toArray(),this.width,this.height,Qt,this._type,(t==null?void 0:t.mapping)||xn,(t==null?void 0:t.wrapS)||ut,(t==null?void 0:t.wrapT)||ut,(t==null?void 0:t.magFilter)||Pe,(t==null?void 0:t.minFilter)||Pe,(t==null?void 0:t.anisotropy)||1,Kt);return n.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof $e&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof dt&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof dt&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const po=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,mo=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class vo extends $e{constructor({gamma:t,offsetHdr:n,offsetSdr:r,gainMapMin:a,gainMapMax:o,maxDisplayBoost:l,hdrCapacityMin:u,hdrCapacityMax:d,sdr:h,gainMap:g}){super({name:"GainMapDecoderMaterial",vertexShader:po,fragmentShader:mo,uniforms:{sdr:{value:h},gainMap:{value:g},gamma:{value:new Se(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Se().fromArray(n)},offsetSdr:{value:new Se().fromArray(r)},gainMapMin:{value:new Se().fromArray(a)},gainMapMax:{value:new Se().fromArray(o)},weightFactor:{value:(Math.log2(l)-u)/(d-u)}},blending:Ct,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=l,this._hdrCapacityMin=u,this._hdrCapacityMax=d,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Oi extends Error{}class Ni extends Error{}const Zt=(e,t,n)=>{const r=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(r)return r[1];const a=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(a){const o=a[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return o&&o.length===3?o.map(l=>l.replace(/<\/?rdf:li>/g,"")):a[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${t} in gainmap metadata`)},go=e=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(e):t=e.toString();let n=t.indexOf("<x:xmpmeta");for(;n!==-1;){const r=t.indexOf("x:xmpmeta>",n),a=t.slice(n,r+10);try{const o=Zt(a,"hdrgm:GainMapMin","0"),l=Zt(a,"hdrgm:GainMapMax"),u=Zt(a,"hdrgm:Gamma","1"),d=Zt(a,"hdrgm:OffsetSDR","0.015625"),h=Zt(a,"hdrgm:OffsetHDR","0.015625"),g=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(a),y=g?g[1]:"0",_=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(a);if(!_)throw new Error("Incomplete gainmap metadata");const B=_[1];return{gainMapMin:Array.isArray(o)?o.map($=>parseFloat($)):[parseFloat(o),parseFloat(o),parseFloat(o)],gainMapMax:Array.isArray(l)?l.map($=>parseFloat($)):[parseFloat(l),parseFloat(l),parseFloat(l)],gamma:Array.isArray(u)?u.map($=>parseFloat($)):[parseFloat(u),parseFloat(u),parseFloat(u)],offsetSdr:Array.isArray(d)?d.map($=>parseFloat($)):[parseFloat(d),parseFloat(d),parseFloat(d)],offsetHdr:Array.isArray(h)?h.map($=>parseFloat($)):[parseFloat(h),parseFloat(h),parseFloat(h)],hdrCapacityMin:parseFloat(y),hdrCapacityMax:parseFloat(B)}}catch{}n=t.indexOf("<x:xmpmeta",r)}};class yo{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((n,r)=>{const a=this.options.debug,o=new DataView(t.buffer);if(o.getUint16(0)!==65496){r(new Error("Not a valid jpeg"));return}const l=o.byteLength;let u=2,d=0,h;for(;u<l;){if(++d>250){r(new Error(`Found no marker after ${d} loops `));return}if(o.getUint8(u)!==255){r(new Error(`Not a valid marker at offset 0x${u.toString(16)}, found: 0x${o.getUint8(u).toString(16)}`));return}if(h=o.getUint8(u+1),a&&console.log(`Marker: ${h.toString(16)}`),h===226){a&&console.log("Found APP2 marker (0xffe2)");const g=u+4;if(o.getUint32(g)===1297106432){const y=g+4;let _;if(o.getUint16(y)===18761)_=!1;else if(o.getUint16(y)===19789)_=!0;else{r(new Error("No valid endianness marker found in TIFF header"));return}if(o.getUint16(y+2,!_)!==42){r(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const B=o.getUint32(y+4,!_);if(B<8){r(new Error("Not valid TIFF data! (First offset less than 8)"));return}const $=y+B,V=o.getUint16($,!_),k=$+2;let A=0;for(let W=k;W<k+12*V;W+=12)o.getUint16(W,!_)===45057&&(A=o.getUint32(W+8,!_));const P=$+2+V*12+4,q=[];for(let W=P;W<P+A*16;W+=16){const L={MPType:o.getUint32(W,!_),size:o.getUint32(W+4,!_),dataOffset:o.getUint32(W+8,!_),dependantImages:o.getUint32(W+12,!_),start:-1,end:-1,isFII:!1};L.dataOffset?(L.start=y+L.dataOffset,L.isFII=!1):(L.start=0,L.isFII=!0),L.end=L.start+L.size,q.push(L)}if(this.options.extractNonFII&&q.length){const W=new Blob([o]),L=[];for(const J of q){if(J.isFII&&!this.options.extractFII)continue;const w=W.slice(J.start,J.end+1,"image/jpeg");L.push(w)}n(L)}}}u+=2+o.getUint16(u+2)}})}}const xo=async e=>{const t=go(e);if(!t)throw new Ni("Gain map XMP metadata not found");const r=await new yo({extractFII:!0,extractNonFII:!0}).extract(e);if(r.length!==2)throw new Oi("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:t}},Qr=e=>new Promise((t,n)=>{const r=document.createElement("img");r.onload=()=>{t(r)},r.onerror=a=>{n(a)},r.src=URL.createObjectURL(e)});class Fi extends ya{constructor(t,n){super(n),t&&(this._renderer=t),this._internalLoadingManager=new xa}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new vo({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new dt,sdr:new dt});return new Qn({width:16,height:16,type:Be,colorSpace:Kt,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,n,r,a){const o=a?new Blob([a],{type:"image/jpeg"}):void 0,l=new Blob([r],{type:"image/jpeg"});let u,d,h=!1;if(typeof createImageBitmap>"u"){const _=await Promise.all([o?Qr(o):Promise.resolve(void 0),Qr(l)]);d=_[0],u=_[1],h=!0}else{const _=await Promise.all([o?createImageBitmap(o,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(l,{imageOrientation:"flipY"})]);d=_[0],u=_[1]}const g=new dt(d||new ImageData(2,2),xn,ut,ut,Pe,lr,Qt,ht,1,Kt);g.flipY=h,g.needsUpdate=!0;const y=new dt(u,xn,ut,ut,Pe,lr,Qt,ht,1,Qe);y.flipY=h,y.needsUpdate=!0,t.width=u.width,t.height=u.height,t.material.gainMap=g,t.material.sdr=y,t.material.gainMapMin=n.gainMapMin,t.material.gainMapMax=n.gainMapMax,t.material.offsetHdr=n.offsetHdr,t.material.offsetSdr=n.offsetSdr,t.material.gamma=n.gamma,t.material.hdrCapacityMin=n.hdrCapacityMin,t.material.hdrCapacityMax=n.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class wo extends Fi{load([t,n,r],a,o,l){const u=this.prepareQuadRenderer();let d,h,g;const y=async()=>{if(d&&h&&g){try{await this.render(u,g,d,h)}catch(x){this.manager.itemError(t),this.manager.itemError(n),this.manager.itemError(r),typeof l=="function"&&l(x),u.disposeOnDemandRenderer();return}typeof a=="function"&&a(u),this.manager.itemEnd(t),this.manager.itemEnd(n),this.manager.itemEnd(r),u.disposeOnDemandRenderer()}};let _=!0,B=0,$=0,V=!0,k=0,A=0,H=!0,P=0,q=0;const W=()=>{if(typeof o=="function"){const x=B+k+P,F=$+A+q,I=_&&V&&H;o(new ProgressEvent("progress",{lengthComputable:I,loaded:F,total:x}))}};this.manager.itemStart(t),this.manager.itemStart(n),this.manager.itemStart(r);const L=new vn(this._internalLoadingManager);L.setResponseType("arraybuffer"),L.setRequestHeader(this.requestHeader),L.setPath(this.path),L.setWithCredentials(this.withCredentials),L.load(t,async x=>{if(typeof x=="string")throw new Error("Invalid sdr buffer");d=x,await y()},x=>{_=x.lengthComputable,$=x.loaded,B=x.total,W()},x=>{this.manager.itemError(t),typeof l=="function"&&l(x)});const J=new vn(this._internalLoadingManager);J.setResponseType("arraybuffer"),J.setRequestHeader(this.requestHeader),J.setPath(this.path),J.setWithCredentials(this.withCredentials),J.load(n,async x=>{if(typeof x=="string")throw new Error("Invalid gainmap buffer");h=x,await y()},x=>{V=x.lengthComputable,A=x.loaded,k=x.total,W()},x=>{this.manager.itemError(n),typeof l=="function"&&l(x)});const w=new vn(this._internalLoadingManager);return w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(r,async x=>{if(typeof x!="string")throw new Error("Invalid metadata string");g=JSON.parse(x),await y()},x=>{H=x.lengthComputable,q=x.loaded,P=x.total,W()},x=>{this.manager.itemError(r),typeof l=="function"&&l(x)}),u}}class Eo extends Fi{load(t,n,r,a){const o=this.prepareQuadRenderer(),l=new vn(this._internalLoadingManager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(this.withCredentials),this.manager.itemStart(t),l.load(t,async u=>{if(typeof u=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const d=new Uint8Array(u);let h,g,y;try{const _=await xo(d);h=_.sdr,g=_.gainMap,y=_.metadata}catch(_){if(_ instanceof Ni||_ instanceof Oi)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),y={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},h=d;else throw _}try{await this.render(o,y,h,g)}catch(_){this.manager.itemError(t),typeof a=="function"&&a(_),o.disposeOnDemandRenderer();return}typeof n=="function"&&n(o),this.manager.itemEnd(t),o.disposeOnDemandRenderer()},r,u=>{this.manager.itemError(t),typeof a=="function"&&a(u)}),o}}const Jt={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Ui="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Mt=e=>Array.isArray(e),Kn=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Mn({files:e=Kn,path:t="",preset:n=void 0,encoding:r=void 0,extensions:a}={}){let o=null,l=!1;n&&(Jn(n),e=Jt[n],t=Ui),l=Mt(e);const{extension:u,isCubemap:d}=er(e);if(o=tr(u),!o)throw new Error("useEnvironment: Unrecognized file extension: "+e);const h=We(B=>B.gl);v.useLayoutEffect(()=>{if(u!=="webp"&&u!=="jpg"&&u!=="jpeg")return;function B(){wn.clear(o,l?[e]:e)}h.domElement.addEventListener("webglcontextlost",B,{once:!0})},[e,h.domElement]);const g=wn(o,l?[e]:e,B=>{(u==="webp"||u==="jpg"||u==="jpeg")&&B.setRenderer(h),B.setPath==null||B.setPath(t),a&&a(B)});let y=l?g[0]:g;if(u==="jpg"||u==="jpeg"||u==="webp"){var _;y=(_=y.renderTarget)==null?void 0:_.texture}return y.mapping=d?wa:Ea,"colorSpace"in y?y.colorSpace=r??d?"srgb":"srgb-linear":y.encoding=r??d?fo:uo,y}const So={files:Kn,path:"",preset:void 0,extensions:void 0};Mn.preload=e=>{const t={...So,...e};let{files:n,path:r=""}=t;const{preset:a,extensions:o}=t;a&&(Jn(a),n=Jt[a],r=Ui);const{extension:l}=er(n);if(l==="webp"||l==="jpg"||l==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const u=tr(l);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+n);wn.preload(u,Mt(n)?[n]:n,d=>{d.setPath==null||d.setPath(r),o&&o(d)})};const _o={files:Kn,preset:void 0};Mn.clear=e=>{const t={..._o,...e};let{files:n}=t;const{preset:r}=t;r&&(Jn(r),n=Jt[r]);const{extension:a}=er(n),o=tr(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+n);wn.clear(o,Mt(n)?[n]:n)};function Jn(e){if(!(e in Jt))throw new Error("Preset must be one of: "+Object.keys(Jt).join(", "))}function er(e){var t;const n=Mt(e)&&e.length===6,r=Mt(e)&&e.length===3&&e.some(l=>l.endsWith("json")),a=Mt(e)?e[0]:e;return{extension:n?"cube":r?"webp":a.startsWith("data:application/exr")?"exr":a.startsWith("data:application/hdr")?"hdr":a.startsWith("data:image/jpeg")?"jpg":(t=a.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:n,isGainmap:r}}function tr(e){return e==="cube"?Sa:e==="hdr"?so:e==="exr"?oo:e==="jpg"||e==="jpeg"?Eo:e==="webp"?wo:null}const Mo=e=>e.current&&e.current.isScene,To=e=>Mo(e)?e.current:e;function nr(e,t,n,r,a={}){var o,l,u,d;a={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...a};const h=To(t||n),g=h.background,y=h.environment,_={backgroundBlurriness:h.backgroundBlurriness,backgroundIntensity:h.backgroundIntensity,backgroundRotation:(o=(l=h.backgroundRotation)==null||l.clone==null?void 0:l.clone())!==null&&o!==void 0?o:[0,0,0],environmentIntensity:h.environmentIntensity,environmentRotation:(u=(d=h.environmentRotation)==null||d.clone==null?void 0:d.clone())!==null&&u!==void 0?u:[0,0,0]};return e!=="only"&&(h.environment=r),e&&(h.background=r),cr(h,a),()=>{e!=="only"&&(h.environment=y),e&&(h.background=g),cr(h,_)}}function rr({scene:e,background:t=!1,map:n,...r}){const a=We(o=>o.scene);return v.useLayoutEffect(()=>{if(n)return nr(t,e,a,n,r)}),null}function Hi({background:e=!1,scene:t,blur:n,backgroundBlurriness:r,backgroundIntensity:a,backgroundRotation:o,environmentIntensity:l,environmentRotation:u,...d}){const h=Mn(d),g=We(y=>y.scene);return v.useLayoutEffect(()=>nr(e,t,g,h,{backgroundBlurriness:n??r,backgroundIntensity:a,backgroundRotation:o,environmentIntensity:l,environmentRotation:u})),v.useEffect(()=>()=>{h.dispose()},[h]),null}function bo({children:e,near:t=.1,far:n=1e3,resolution:r=256,frames:a=1,map:o,background:l=!1,blur:u,backgroundBlurriness:d,backgroundIntensity:h,backgroundRotation:g,environmentIntensity:y,environmentRotation:_,scene:B,files:$,path:V,preset:k=void 0,extensions:A}){const H=We(w=>w.gl),P=We(w=>w.scene),q=v.useRef(null),[W]=v.useState(()=>new yn),L=v.useMemo(()=>{const w=new _a(r);return w.texture.type=Be,w},[r]);v.useEffect(()=>()=>{L.dispose()},[L]),v.useLayoutEffect(()=>{if(a===1){const w=H.autoClear;H.autoClear=!0,q.current.update(H,W),H.autoClear=w}return nr(l,B,P,L.texture,{backgroundBlurriness:u??d,backgroundIntensity:h,backgroundRotation:g,environmentIntensity:y,environmentRotation:_})},[e,W,L.texture,B,P,l,a,H]);let J=1;return pt(()=>{if(a===1/0||J<a){const w=H.autoClear;H.autoClear=!0,q.current.update(H,W),H.autoClear=w,J++}}),v.createElement(v.Fragment,null,Ma(v.createElement(v.Fragment,null,e,v.createElement("cubeCamera",{ref:q,args:[t,n,L]}),$||k?v.createElement(Hi,{background:!0,files:$,preset:k,path:V,extensions:A}):o?v.createElement(rr,{background:!0,map:o,extensions:A}):null),W))}function Ro(e){var t,n,r,a;const o=Mn(e),l=e.map||o;v.useMemo(()=>$n({GroundProjectedEnvImpl:ao}),[]),v.useEffect(()=>()=>{o.dispose()},[o]);const u=v.useMemo(()=>[l],[l]),d=(t=e.ground)==null?void 0:t.height,h=(n=e.ground)==null?void 0:n.radius,g=(r=(a=e.ground)==null?void 0:a.scale)!==null&&r!==void 0?r:1e3;return v.createElement(v.Fragment,null,v.createElement(rr,ui({},e,{map:l})),v.createElement("groundProjectedEnvImpl",{args:u,scale:g,height:d,radius:h}))}function Co(e){return e.ground?v.createElement(Ro,e):e.map?v.createElement(rr,e):e.children?v.createElement(bo,e):v.createElement(Hi,e)}/**
 * postprocessing v6.36.6 build Tue Dec 31 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rschen
 * @license Zlib
 */var Ln=1/1e3,Ao=1e3,Io=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Ln}get fixedDelta(){return this._fixedDelta*Ln}set fixedDelta(e){this._fixedDelta=e*Ao}get elapsed(){return this._elapsed*Ln}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Po=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),n=new Si;return n.setAttribute("position",new ur(e,3)),n.setAttribute("uv",new ur(t,2)),n})(),Oe=class Wn{static get fullscreenGeometry(){return Po}constructor(t="Pass",n=new yn,r=new Aa){this.name=t,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let n=this.screen;n!==null?n.material=t:(n=new Rt(Wn.fullscreenGeometry,t),n.frustumCulled=!1,this.scene===null&&(this.scene=new yn),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,n=At){}render(t,n,r,a,o){throw new Error("Render method not implemented!")}setSize(t,n){}initialize(t,n,r){}dispose(){for(const t of Object.keys(this)){const n=this[t];(n instanceof Xe||n instanceof Ei||n instanceof dt||n instanceof Wn)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Do=class extends Oe{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,r,a){const o=e.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},Lo=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,ir="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Bo=class extends $e{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new ae(null),opacity:new ae(1)},blending:Ct,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Lo,vertexShader:ir})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},zi=class extends Oe{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Bo,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Xe(1,1,{minFilter:Pe,magFilter:Pe,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,n,r,a){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==ht?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e!==null&&e.outputColorSpace===Qe&&(this.renderTarget.texture.colorSpace=Qe))}},Kr=new en,ki=class extends Oe{constructor(e=!0,t=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,n){this.color=e,this.depth=t,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,n,r,a){const o=this.overrideClearColor,l=this.overrideClearAlpha,u=e.getClearAlpha(),d=o!==null,h=l>=0;d?(e.getClearColor(Kr),e.setClearColor(o,h?l:u)):h&&e.setClearAlpha(l),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),d?e.setClearColor(Kr,u):h&&e.setClearAlpha(u)}},Oo=class extends Oe{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new ki(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,r,a){const o=e.getContext(),l=e.state.buffers,u=this.scene,d=this.camera,h=this.clearPass,g=this.inverted?0:1,y=1-g;l.color.setMask(!1),l.depth.setMask(!1),l.color.setLocked(!0),l.depth.setLocked(!0),l.stencil.setTest(!0),l.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),l.stencil.setFunc(o.ALWAYS,g,4294967295),l.stencil.setClear(y),l.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(u,d)):(e.setRenderTarget(t),e.render(u,d),e.setRenderTarget(n),e.render(u,d)),l.color.setLocked(!1),l.depth.setLocked(!1),l.stencil.setLocked(!1),l.stencil.setFunc(o.EQUAL,1,4294967295),l.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),l.stencil.setLocked(!0)}},No=class{constructor(t=null,{depthBuffer:n=!0,stencilBuffer:r=!1,multisampling:a=0,frameBufferType:o}={}){this.renderer=null,this.inputBuffer=this.createBuffer(n,r,o,a),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new zi,this.depthTexture=null,this.passes=[],this.timer=new Io,this.autoRenderToScreen=!0,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){const n=this.inputBuffer,r=this.multisampling;r>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,t),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,t!==null){const n=t.getSize(new be),r=t.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;a===ht&&t.outputColorSpace===Qe&&(this.inputBuffer.texture.colorSpace=Qe,this.outputBuffer.texture.colorSpace=Qe,this.inputBuffer.dispose(),this.outputBuffer.dispose()),t.autoClear=!1,this.setSize(n.width,n.height);for(const o of this.passes)o.initialize(t,r,a)}}replaceRenderer(t,n=!0){const r=this.renderer,a=r.domElement.parentNode;return this.setRenderer(t),n&&a!==null&&(a.removeChild(r.domElement),a.appendChild(t.domElement)),r}createDepthTexture(){const t=this.depthTexture=new Ta;return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=ba,t.type=Ra):t.type=gi,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const t of this.passes)t.setDepthTexture(null)}}createBuffer(t,n,r,a){const o=this.renderer,l=o===null?new be:o.getDrawingBufferSize(new be),u={minFilter:Pe,magFilter:Pe,stencilBuffer:n,depthBuffer:t,type:r},d=new Xe(l.width,l.height,u);return a>0&&(d.ignoreDepthForMultisampleCopy=!1,d.samples=a),r===ht&&o!==null&&o.outputColorSpace===Qe&&(d.texture.colorSpace=Qe),d.texture.name="EffectComposer.Buffer",d.texture.generateMipmaps=!1,d}setMainScene(t){for(const n of this.passes)n.mainScene=t}setMainCamera(t){for(const n of this.passes)n.mainCamera=t}addPass(t,n){const r=this.passes,a=this.renderer,o=a.getDrawingBufferSize(new be),l=a.getContext().getContextAttributes().alpha,u=this.inputBuffer.texture.type;if(t.setRenderer(a),t.setSize(o.width,o.height),t.initialize(a,l,u),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),n!==void 0?r.splice(n,0,t):r.push(t),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const d=this.createDepthTexture();for(t of r)t.setDepthTexture(d)}else t.setDepthTexture(this.depthTexture)}removePass(t){const n=this.passes,r=n.indexOf(t);if(r!==-1&&n.splice(r,1).length>0){if(this.depthTexture!==null){const l=(d,h)=>d||h.needsDepthTexture;n.reduce(l,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===n.length&&(t.renderToScreen=!1,n.length>0&&(n[n.length-1].renderToScreen=!0))}}removeAllPasses(){const t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){const n=this.renderer,r=this.copyPass;let a=this.inputBuffer,o=this.outputBuffer,l=!1,u,d,h;t===void 0&&(this.timer.update(),t=this.timer.getDelta());for(const g of this.passes)g.enabled&&(g.render(n,a,o,t,l),g.needsSwap&&(l&&(r.renderToScreen=g.renderToScreen,u=n.getContext(),d=n.state.buffers.stencil,d.setFunc(u.NOTEQUAL,1,4294967295),r.render(n,a,o,t,l),d.setFunc(u.EQUAL,1,4294967295)),h=a,a=o,o=h),g instanceof Oo?l=!0:g instanceof Do&&(l=!1))}setSize(t,n,r){const a=this.renderer,o=a.getSize(new be);(t===void 0||n===void 0)&&(t=o.width,n=o.height),(o.width!==t||o.height!==n)&&a.setSize(t,n,r);const l=a.getDrawingBufferSize(new be);this.inputBuffer.setSize(l.width,l.height),this.outputBuffer.setSize(l.width,l.height);for(const u of this.passes)u.setSize(l.width,l.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Oe.fullscreenGeometry.dispose()}},it={NONE:0,DEPTH:1,CONVOLUTION:2},te={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Fo=class{constructor(){this.shaderParts=new Map([[te.FRAGMENT_HEAD,null],[te.FRAGMENT_MAIN_UV,null],[te.FRAGMENT_MAIN_IMAGE,null],[te.VERTEX_HEAD,null],[te.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=it.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Kt}},Bn=!1,Jr=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let n;if(t.material.flatShading)switch(t.material.side){case Et:n=this.materialsFlatShadedDoubleSide;break;case dn:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(t.material.side){case Et:n=this.materialsDoubleSide;break;case dn:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=n[2]:t.isInstancedMesh?t.material=n[1]:t.material=n[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof $e))return e.clone();const t=e.uniforms,n=new Map;for(const a in t){const o=t[a].value;o.isRenderTargetTexture&&(t[a].value=null,n.set(a,o))}const r=e.clone();for(const a of n)t[a[0]].value=a[1],r.uniforms[a[0]].value=a[1];return r}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const n of t)n.uniforms=Object.assign({},e.uniforms),n.side=wi;t[2].skinning=!0,this.materialsBackSide=t.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},e.uniforms),r.side=dn,r}),this.materialsDoubleSide=t.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},e.uniforms),r.side=Et,r}),this.materialsFlatShaded=t.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=dn,r}),this.materialsFlatShadedDoubleSide=t.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Et,r})}}render(e,t,n){const r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Bn){const a=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);for(const o of a)o[0].material=o[1];this.meshCount!==a.size&&a.clear()}else{const a=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=a}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Bn}static set workaroundEnabled(e){Bn=e}},ct=-1,at=class extends Xn{constructor(e,t=ct,n=ct,r=1){super(),this.resizable=e,this.baseSize=new be(1,1),this.preferredSize=new be(t,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new be,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,n=this.effectiveSize,r=this.scale;t.width!==ct?n.width=t.width:t.height!==ct?n.width=Math.round(t.height*(e.width/Math.max(e.height,1))):n.width=Math.round(e.width*r),t.height!==ct?n.height=t.height:t.width!==ct?n.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n.height=Math.round(e.height*r)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(ct),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ct}},K={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Uo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Ho="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",zo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",ko="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Go="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Wo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",jo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Vo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Zo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",$o="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Xo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",qo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Yo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Qo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Ko="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Jo="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",el="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",tl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",nl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",rl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",il="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",al="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",sl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",ol="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",ll="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",cl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",ul="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",dl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",fl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",hl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",pl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",ml="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",vl=new Map([[K.ADD,Uo],[K.ALPHA,Ho],[K.AVERAGE,zo],[K.COLOR,ko],[K.COLOR_BURN,Go],[K.COLOR_DODGE,Wo],[K.DARKEN,jo],[K.DIFFERENCE,Vo],[K.DIVIDE,Zo],[K.DST,null],[K.EXCLUSION,$o],[K.HARD_LIGHT,Xo],[K.HARD_MIX,qo],[K.HUE,Yo],[K.INVERT,Qo],[K.INVERT_RGB,Ko],[K.LIGHTEN,Jo],[K.LINEAR_BURN,el],[K.LINEAR_DODGE,tl],[K.LINEAR_LIGHT,nl],[K.LUMINOSITY,rl],[K.MULTIPLY,il],[K.NEGATION,al],[K.NORMAL,sl],[K.OVERLAY,ol],[K.PIN_LIGHT,ll],[K.REFLECT,cl],[K.SATURATION,ul],[K.SCREEN,dl],[K.SOFT_LIGHT,fl],[K.SRC,hl],[K.SUBTRACT,pl],[K.VIVID_LIGHT,ml]]),gl=class extends Xn{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new ae(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return vl.get(this.blendFunction)}},yl=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,xl=class extends $e{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:qn.replace(/\D+/g,"")},uniforms:{inputBuffer:new ae(null),threshold:new ae(0),smoothing:new ae(1),range:new ae(null)},blending:Ct,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:yl,vertexShader:ir}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},wl=class extends Oe{constructor({renderTarget:e,luminanceRange:t,colorOutput:n,resolutionScale:r=1,width:a=at.AUTO_SIZE,height:o=at.AUTO_SIZE,resolutionX:l=a,resolutionY:u=o}={}){super("LuminancePass"),this.fullscreenMaterial=new xl(n,t),this.needsSwap=!1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Xe(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const d=this.resolution=new at(this,l,u,r);d.addEventListener("change",h=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,n,r,a){const o=this.fullscreenMaterial;o.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}initialize(e,t,n){n!==void 0&&n!==ht&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Sn=class extends Xn{constructor(e,t,{attributes:n=it.NONE,blendFunction:r=K.NORMAL,defines:a=new Map,uniforms:o=new Map,extensions:l=null,vertexShader:u=null}={}){super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=t,this.vertexShader=u,this.defines=a,this.uniforms=o,this.extensions=l,this.blendMode=new gl(r),this.blendMode.addEventListener("change",d=>this.setChanged()),this._inputColorSpace=Kt,this._outputColorSpace=xi}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=At){}update(e,t,n){}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Xe||t instanceof Ei||t instanceof dt||t instanceof Oe)&&this[e].dispose()}}},Gi=class extends Oe{constructor(e,t,n=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new ki,this.overrideMaterialManager=n===null?null:new Jr(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new Jr(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,r,a){const o=this.scene,l=this.camera,u=this.selection,d=l.layers.mask,h=o.background,g=e.shadowMap.autoUpdate,y=this.renderToScreen?null:t;u!==null&&l.layers.set(u.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(y),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,o,l):e.render(o,l),l.layers.mask=d,o.background=h,e.shadowMap.autoUpdate=g}},Le={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},$t={DEFAULT:0,ESKIL:1},El=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Sl="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",_l=class extends $e{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ae(null),normalBuffer:new ae(null),texelSize:new ae(new be)},blending:Ct,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:El,vertexShader:Sl})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=At){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,e!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ml=class extends Oe{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:n=at.AUTO_SIZE,height:r=at.AUTO_SIZE,resolutionX:a=n,resolutionY:o=r}={}){super("DepthDownsamplingPass");const l=new _l;l.normalBuffer=e,this.fullscreenMaterial=l,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Xe(1,1,{minFilter:Tt,magFilter:Tt,depthBuffer:!1,type:Ke}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const u=this.resolution=new at(this,a,o,t);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=At){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,n,r,a){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,n){const r=e.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},Tl=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,bl=class extends $e{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new ae(null),luminanceBuffer1:new ae(null),minLuminance:new ae(.01),deltaTime:new ae(0),tau:new ae(1)},extensions:{shaderTextureLOD:!0},blending:Ct,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Tl,vertexShader:ir})}set luminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}setLuminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}set luminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}setLuminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}set mipLevel1x1(e){this.defines.MIP_LEVEL_1X1=e.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(e){this.mipLevel1x1=e}set deltaTime(e){this.uniforms.deltaTime.value=e}setDeltaTime(e){this.uniforms.deltaTime.value=e}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(e){this.uniforms.minLuminance.value=e}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(e){this.uniforms.minLuminance.value=e}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(e){this.uniforms.tau.value=e}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(e){this.uniforms.tau.value=e}},Rl=class extends Oe{constructor(e,{minLuminance:t=.01,adaptationRate:n=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new bl,this.needsSwap=!1,this.renderTargetPrevious=new Xe(1,1,{minFilter:Tt,magFilter:Tt,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const r=this.fullscreenMaterial;r.luminanceBuffer0=this.renderTargetPrevious.texture,r.luminanceBuffer1=e,r.minLuminance=t,r.adaptationRate=n,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new zi(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(e){this.fullscreenMaterial.mipLevel1x1=e}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(e){this.fullscreenMaterial.adaptationRate=e}render(e,t,n,r,a){this.fullscreenMaterial.deltaTime=r,e.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),e.render(this.scene,this.camera),this.copyPass.render(e,this.renderTargetAdapted)}},Cl=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,Al=class extends Sn{constructor({blendFunction:e=K.SRC,adaptive:t=!1,mode:n=t?Le.REINHARD2_ADAPTIVE:Le.AGX,resolution:r=256,maxLuminance:a=4,whitePoint:o=a,middleGrey:l=.6,minLuminance:u=.01,averageLuminance:d=1,adaptationRate:h=1}={}){super("ToneMappingEffect",Cl,{blendFunction:e,uniforms:new Map([["luminanceBuffer",new ae(null)],["maxLuminance",new ae(a)],["whitePoint",new ae(o)],["middleGrey",new ae(l)],["averageLuminance",new ae(d)]])}),this.renderTargetLuminance=new Xe(1,1,{minFilter:Ia,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new wl({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new Rl(this.luminancePass.texture,{minLuminance:u,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=r,this.mode=n}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode===e)return;const n=qn.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case Le.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Le.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Le.CINEON:case Le.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",n);break;case Le.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Le.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Le.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=e===Le.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),n=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(n,n),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===Le.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?Le.REINHARD2_ADAPTIVE:Le.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,n){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,n))}initialize(e,t,n){this.adaptiveLuminancePass.initialize(e,t,n)}},Il=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Pl=class extends Sn{constructor({blendFunction:e,eskil:t=!1,technique:n=t?$t.ESKIL:$t.DEFAULT,offset:r=.5,darkness:a=.5}={}){super("VignetteEffect",Il,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",n.toFixed(0)]]),uniforms:new Map([["offset",new ae(r)],["darkness",new ae(a)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===$t.ESKIL}set eskil(e){this.technique=e?$t.ESKIL:$t.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},Dl=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Ll="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Bl=class extends $e{constructor(e,t,n,r,a=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:qn.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ae(null),depthBuffer:new ae(null),resolution:new ae(new be),texelSize:new ae(new be),cameraNear:new ae(.3),cameraFar:new ae(1e3),aspect:new ae(1),time:new ae(0)},blending:Ct,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:a}),e&&this.setShaderParts(e),t&&this.setDefines(t),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=At){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=Dl.replace(te.FRAGMENT_HEAD,e.get(te.FRAGMENT_HEAD)||"").replace(te.FRAGMENT_MAIN_UV,e.get(te.FRAGMENT_MAIN_UV)||"").replace(te.FRAGMENT_MAIN_IMAGE,e.get(te.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Ll.replace(te.VERTEX_HEAD,e.get(te.VERTEX_HEAD)||"").replace(te.VERTEX_MAIN_SUPPORT,e.get(te.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Zn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}static get Section(){return te}};function ei(e,t,n){for(const r of t){const a="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),o=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const l of n.entries())l[1]!==null&&n.set(l[0],l[1].replace(o,a))}}function Ol(e,t,n){let r=t.getFragmentShader(),a=t.getVertexShader();const o=r!==void 0&&/mainImage/.test(r),l=r!==void 0&&/mainUv/.test(r);if(n.attributes|=t.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(l&&n.attributes&it.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!o&&!l)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const u=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,d=n.shaderParts;let h=d.get(te.FRAGMENT_HEAD)||"",g=d.get(te.FRAGMENT_MAIN_UV)||"",y=d.get(te.FRAGMENT_MAIN_IMAGE)||"",_=d.get(te.VERTEX_HEAD)||"",B=d.get(te.VERTEX_MAIN_SUPPORT)||"";const $=new Set,V=new Set;if(l&&(g+=`	${e}MainUv(UV);
`,n.uvTransformation=!0),a!==null&&/mainSupport/.test(a)){const H=/mainSupport *\([\w\s]*?uv\s*?\)/.test(a);B+=`	${e}MainSupport(`,B+=H?`vUv);
`:`);
`;for(const P of a.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const q of P[1].split(/\s*,\s*/))n.varyings.add(q),$.add(q),V.add(q);for(const P of a.matchAll(u))V.add(P[1])}for(const H of r.matchAll(u))V.add(H[1]);for(const H of t.defines.keys())V.add(H.replace(/\([\w\s,]*\)/g,""));for(const H of t.uniforms.keys())V.add(H);V.delete("while"),V.delete("for"),V.delete("if"),t.uniforms.forEach((H,P)=>n.uniforms.set(e+P.charAt(0).toUpperCase()+P.slice(1),H)),t.defines.forEach((H,P)=>n.defines.set(e+P.charAt(0).toUpperCase()+P.slice(1),H));const k=new Map([["fragment",r],["vertex",a]]);ei(e,V,n.defines),ei(e,V,k),r=k.get("fragment"),a=k.get("vertex");const A=t.blendMode;if(n.blendModes.set(A.blendFunction,A),o){t.inputColorSpace!==null&&t.inputColorSpace!==n.colorSpace&&(y+=t.inputColorSpace===Qe?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==xi?n.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(n.colorSpace=t.inputColorSpace);const H=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;y+=`${e}MainImage(color0, UV, `,n.attributes&it.DEPTH&&H.test(r)&&(y+="depth, ",n.readDepth=!0),y+=`color1);
	`;const P=e+"BlendOpacity";n.uniforms.set(P,A.opacity),y+=`color0 = blend${A.blendFunction}(color0, color1, ${P});

	`,h+=`uniform float ${P};

`}if(h+=r+`
`,a!==null&&(_+=a+`
`),d.set(te.FRAGMENT_HEAD,h),d.set(te.FRAGMENT_MAIN_UV,g),d.set(te.FRAGMENT_MAIN_IMAGE,y),d.set(te.VERTEX_HEAD,_),d.set(te.VERTEX_MAIN_SUPPORT,B),t.extensions!==null)for(const H of t.extensions)n.extensions.add(H)}}var Nl=class extends Oe{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Bl(null,null,null,e),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,n)=>n.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new Fo;let t=0;for(const l of this.effects)if(l.blendMode.blendFunction===K.DST)e.attributes|=l.getAttributes()&it.DEPTH;else{if(e.attributes&l.getAttributes()&it.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${l.name})`);Ol("e"+t++,l,e)}let n=e.shaderParts.get(te.FRAGMENT_HEAD),r=e.shaderParts.get(te.FRAGMENT_MAIN_IMAGE),a=e.shaderParts.get(te.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const l of e.blendModes.values())n+=l.getShaderCode().replace(o,`blend${l.blendFunction}`)+`
`;e.attributes&it.DEPTH?(e.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===Qe&&(r+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(a=`vec2 transformedUv = vUv;
`+a,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(te.FRAGMENT_HEAD,n),e.shaderParts.set(te.FRAGMENT_MAIN_IMAGE,r),e.shaderParts.set(te.FRAGMENT_MAIN_UV,a);for(const[l,u]of e.shaderParts)u!==null&&e.shaderParts.set(l,u.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=At){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const n of this.effects)n.setDepthTexture(e,t)}render(e,t,n,r,a){for(const o of this.effects)o.update(e,t,r);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=t.texture,o.time+=r*this.timeScale,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const n of this.effects)n.setSize(e,t)}initialize(e,t,n){this.renderer=e;for(const r of this.effects)r.initialize(e,t,n);this.updateMaterial(),n!==void 0&&n!==ht&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},Fl=class extends Oe{constructor(e,t,{renderTarget:n,resolutionScale:r=1,width:a=at.AUTO_SIZE,height:o=at.AUTO_SIZE,resolutionX:l=a,resolutionY:u=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Gi(e,t,new Ca);const d=this.renderPass;d.ignoreBackground=!0,d.skipShadowMapUpdate=!0;const h=d.getClearPass();h.overrideClearColor=new en(7829503),h.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Xe(1,1,{minFilter:Tt,magFilter:Tt}),this.renderTarget.texture.name="NormalPass.Target");const g=this.resolution=new at(this,l,u,r);g.addEventListener("change",y=>this.setSize(g.baseWidth,g.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,r,a){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,o,o)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}};const Ul=v.createContext(null),ti=e=>(e.getAttributes()&it.CONVOLUTION)===it.CONVOLUTION,Hl=Yt.memo(v.forwardRef(({children:e,camera:t,scene:n,resolutionScale:r,enabled:a=!0,renderPriority:o=1,autoClear:l=!0,depthBuffer:u,enableNormalPass:d,stencilBuffer:h,multisampling:g=8,frameBufferType:y=Be},_)=>{const{gl:B,scene:$,camera:V,size:k}=We(),A=n||$,H=t||V,[P,q,W]=v.useMemo(()=>{const w=js(),x=new No(B,{depthBuffer:u,stencilBuffer:h,multisampling:g>0&&w?g:0,frameBufferType:y});x.addPass(new Gi(A,H));let F=null,I=null;return d&&(I=new Fl(A,H),I.enabled=!1,x.addPass(I),r!==void 0&&w&&(F=new Ml({normalBuffer:I.texture,resolutionScale:r}),F.enabled=!1,x.addPass(F))),[x,I,F]},[H,B,u,h,g,y,A,d,r]);v.useEffect(()=>P==null?void 0:P.setSize(k.width,k.height),[P,k]),pt((w,x)=>{if(a){const F=B.autoClear;B.autoClear=l,h&&!l&&B.clearStencil(),P.render(x),B.autoClear=F}},a?o:0);const L=v.useRef(null);v.useLayoutEffect(()=>{var w;const x=[],F=(w=L.current)==null?void 0:w.__r3f;if(F&&P){const I=F.objects;for(let O=0;O<I.length;O++){const Z=I[O];if(Z instanceof Sn){const U=[Z];if(!ti(Z)){let S=null;for(;(S=I[O+1])instanceof Sn&&!ti(S);)U.push(S),O++}const j=new Nl(H,...U);x.push(j)}else Z instanceof Oe&&x.push(Z)}for(const O of x)P==null||P.addPass(O);q&&(q.enabled=!0),W&&(W.enabled=!0)}return()=>{for(const I of x)P==null||P.removePass(I);q&&(q.enabled=!1),W&&(W.enabled=!1)}},[P,e,H,q,W]),v.useEffect(()=>{const w=B.toneMapping;return B.toneMapping=Pa,()=>{B.toneMapping=w}},[B]);const J=v.useMemo(()=>({composer:P,normalPass:q,downSamplingPass:W,resolutionScale:r,camera:H,scene:A}),[P,q,W,r,H,A]);return v.useImperativeHandle(_,()=>P,[P]),N.jsx(Ul.Provider,{value:J,children:N.jsx("group",{ref:L,children:e})})}));let zl=0;const ni=new WeakMap,Wi=(e,t)=>Yt.forwardRef(function({blendFunction:r=void 0,opacity:a=void 0,...o},l){let u=ni.get(e);if(!u){const g=`@react-three/postprocessing/${e.name}-${zl++}`;$n({[g]:e}),ni.set(e,u=g)}const d=We(g=>g.camera),h=Yt.useMemo(()=>{var g,y;return[...(g=void 0)!=null?g:[],...(y=o.args)!=null?y:[{...t,...o}]]},[JSON.stringify(o)]);return N.jsx(u,{camera:d,"blendMode-blendFunction":r,"blendMode-opacity-value":a,...o,ref:l,args:h})}),kl=Wi(Al),Gl=Wi(Pl),Wl=v.createContext(void 0),jl=({initialPoi:e,children:t})=>{const[n,r]=v.useState(e),[a,o]=v.useState(null),l=u=>{o(n),r(u)};return N.jsx(Wl.Provider,{value:{activePoi:n,previousPoi:a,setActivePoi:l},children:t})},Vl=({modelData:e})=>N.jsx("group",{dispose:null,children:e.map((t,n)=>N.jsx(Zl,{...t},n))});function Zl(e){const t=di+e.path,{scene:n}=_i(t),r=v.useMemo(()=>{const a=new Da;return a.position.copy(n.position),a.rotation.copy(n.rotation),a.scale.copy(n.scale),n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),a.add(n),a},[n]);return v.useEffect(()=>{n.traverse(a=>{a.isMesh&&(a.castShadow=!0,a.receiveShadow=!0)})},[n]),N.jsx("primitive",{object:r,dispose:null})}const mn=[{name:"Start",offset:0},{name:"Boat front",offset:.38,threeDText:{text:"Communicate complex ideas in a simple way!",position:[-.0819,.2569,.234],rotation:[0,0,0],scale:[3e-5,3e-5,3e-5],outlineColor:"#000000",outlineWidth:.005}},{name:"Windmill side",offset:.52,threeDText:{text:"Find new and engaging ways to present your ideas and products",position:[-.082,.27,.224],rotation:[0,-Math.PI/2,0],scale:[.004,.004,.004]}},{name:"Windmill",offset:.707,threeDText:{text:"Highly technical models that you can interact with",position:[-.08,.23,.19],rotation:[0,Math.PI,0],scale:[.08,.08,.08]}},{name:"Robot Pickup",offset:.85,threeDText:{text:"Tailor your sales journey to your customer needs",position:[-.08,.6,1.2],rotation:[0,2.2,0],scale:[.3,.3,.3]}}],$l=({title:e,description:t,parentStyling:n})=>N.jsx($a,{sx:{display:"flex",flexDirection:"column",maxWidth:"25rem",height:"25rem",backgroundColor:"rgba(0, 0, 0, 0.8)",pointerEvents:"none",borderRadius:"5rem",padding:"3rem",...n},children:N.jsxs(Qa,{sx:{flex:1},children:[e&&N.jsx(Nn,{variant:"h5",component:"div",sx:{fontFamily:"Red Hat Display",fontWeight:700,color:"white",paddingBottom:1},children:e}),t&&t.map((r,a)=>N.jsx(Nn,{variant:"body2",sx:{fontFamily:"Red Hat Display",fontWeight:400,color:"white",paddingTop:1},children:r},a))]})}),Xl=({modelData:e,scrollLength:t=1})=>N.jsx(Ws,{pages:t,children:N.jsx(ql,{modelData:e,stopDelay:600})});function ql({modelData:e,stopDelay:t=1e3}){const{camera:n}=We(),r=Gs(),a=di+e.path,{scene:o,animations:l}=_i(a),u=o.getObjectByName("RS_Camera"),d=o.getObjectByName("Rotor"),{actions:h}=co(l,o),[g,y]=v.useState(0),[_,B]=v.useState(0),$=v.useRef(null),V=v.useRef(null),k=v.useRef(null);v.useEffect(()=>void(h.Animation.play().paused=!0),[h]);const A=mn,H=.08,[P,q]=v.useState(0),[W,L]=v.useState(!1),[J,w]=v.useState(!0),[x,F]=v.useState(!1);v.useEffect(()=>{r.el&&(r.el.style.overflow="scroll",r.el.style.scrollbarWidth="none",r.el.style.msOverflowStyle="none")},[r]),v.useEffect(()=>{if(V.current){const S=o.getObjectByName("Tanker");S&&V.current&&S.add(V.current)}},[V.current,o]),o.traverse(S=>{S.name.includes("Placeholder")&&(S.visible=!1),S.name.includes("PlaneToHide")&&(S.visible=!1),S.name==="StartWindow"&&S instanceof Rt&&($.current=S,S.visible=!1)});const I=()=>{for(let S=0;S<A.length;S++)if(Math.abs(r.offset-A[S].offset)<H){if(S===P)return;L(!0),w(!0),r.el.style.touchAction="none",q(S),console.log("Scroll locked to stop: ",S),setTimeout(()=>{L(!1),r.el.style.touchAction="auto",console.log("Scroll unlocked")},t);break}},O=S=>{W?S.preventDefault():J&&!x&&(F(!0),setTimeout(()=>{w(!1),F(!1)},1e3))},Z=()=>{if(u){const S=u.getWorldPosition(new Se),X=u.getWorldQuaternion(new bt);n.position.set(S.x,S.y,S.z),n.quaternion.set(X.x,X.y,X.z,X.w),_<.2?(n.near=2e-5,n.far=1):_<.6?(n.near=1e-4,n.far=5):(n.near=.02,n.far=80),n.updateProjectionMatrix()}else console.warn("RS_Camera not found in scene.")},U=v.useRef(null),j=v.useRef(null);return v.useEffect(()=>{if(!U.current){const S=document.getElementById("ui-overlay");if(!S){console.error("UI overlay not found!");return}const X=document.createElement("div");X.id="scrollOverlay",X.style.position="absolute",X.style.pointerEvents="none",X.style.top="0vh",X.style.left="0",X.style.width="100%",X.style.height=`${200*mn.length}vh`,S.appendChild(X),U.current=X,j.current=ci.createRoot(X),j.current.render(N.jsx(N.Fragment,{children:mn.map((le,we)=>le.poiInfo&&N.jsx(fi,{sx:{position:"absolute",top:`${le.offset*(mn.length-1)*200+50}vh`,left:"2rem",right:"2rem",transform:"translateY(-50%)",pointerEvents:"none"},children:N.jsx($l,{title:le.poiInfo.title,description:le.poiInfo.description,image:le.poiInfo.image,globalPath:le.poiInfo.globalPath})},we))}))}return()=>{var S;j.current&&j.current.unmount(),(S=U.current)==null||S.remove()}},[]),v.useEffect(()=>(r.el.addEventListener("wheel",O,{passive:!1}),r.el.addEventListener("touchmove",O,{passive:!1}),()=>{r.el.removeEventListener("wheel",O),r.el.removeEventListener("touchmove",O)})),pt((S,X)=>{const le=h.Animation;!W&&!J&&(jn||I()),d&&d.rotateZ(X*-1.6),k.current&&k.current&&k.current.rotateZ(X*.2),W?(r.el.scrollTop=A[P].offset*(r.el.scrollHeight-r.el.clientHeight),y(A[P].offset)):y(r.offset),Math.abs(le.time/le.getClip().duration-g)>1e-4?le.time=gn.damp(le.time,le.getClip().duration*g,3,X):le.time=le.getClip().duration*g,B(le.time/le.getClip().duration),U.current&&(U.current.style.top=-(_*200*(A.length-1))+"vh"),Z(),jn&&(console.log("Scroll offset: ",r.offset),console.log("Animation offset: ",_))}),N.jsxs("group",{scale:10,children:[N.jsx("primitive",{object:o,dispose:null}),$.current&&N.jsx("mesh",{ref:V,geometry:$.current.geometry,position:$.current.position,children:N.jsxs(La,{children:[N.jsx("color",{attach:"background",args:["#ffffff"]}),N.jsx("mesh",{ref:k,scale:.4,rotation:[-.5,0,0],position:[0,0,.012],children:N.jsx(Ba,{src:"projects/scrollDemo/models/iconCircle2.glb",rotation:[Math.PI,0,0],children:N.jsx("meshStandardMaterial",{side:wi})})})]})}),A.map((S,X)=>S.threeDText&&N.jsx(Yl,{text:S.threeDText.text,position:S.threeDText.position,rotation:S.threeDText.rotation,scale:S.threeDText.scale,stopOffset:S.offset,scrollOffset:_,color:S.threeDText.color,outlineColor:S.threeDText.outlineColor,outlineWidth:S.threeDText.outlineWidth},X))]})}const Yl=({text:e,position:t=[0,0,0],rotation:n=[0,0,0],scale:r=[1,1,1],scrollOffset:a,stopOffset:o,fadeDistance:l=.08,color:u="#ffffff",outlineColor:d=u,outlineWidth:h=0})=>{const[g,y]=v.useState(0);return v.useEffect(()=>{const _=Math.abs(a-o),B=1-Math.min(_/l,1);y(B)},[a,o,l]),N.jsx(Oa,{font:"fonts/RedHatDisplay-SemiBold.ttf",color:u,anchorY:"top",anchorX:"left",fontSize:.5,position:t,rotation:n,scale:r,maxWidth:5,lineHeight:1.2,fillOpacity:g,outlineColor:d,outlineWidth:h,children:e})},Ql=()=>{const{progress:e}=fs();return N.jsx(os,{center:!0,children:N.jsxs(fi,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:[N.jsx(Na,{size:80,thickness:4}),N.jsxs(Nn,{variant:"h6",color:"textPrimary",mt:2,children:[Math.round(e),"% Loaded"]})]})})},On={sceneTitle:"Scroll Demo",sceneModels:[{path:"/models/scrollDemo3.glb",castShadow:!0,receiveShadow:!0}],canvasSettings:{backgroundColor:"#666666",antialias:!0,environmentProps:{preset:"studio",background:!1,environmentIntensity:.1,backgroundBlurriness:.1},usePostEffects:!0},parentPoi:{name:"Test scene parent POI",description:"The parent POI for the test scene, encompassing all child POIs.",type:"staticObject",isMaster:!0,cameraControls:{type:"orbit",enablePan:!1,startPosition:{x:0,y:2,z:10},targetOffset:{x:0,y:1,z:0},constraints:{up:50,down:-1,minZoom:1,maxZoom:12}}},debugSettings:{allTrue:!1,gridHelper:!1,axesHelper:!1,stats:!1,lightHelpers:!1}},Kl=({cameraSettings:e,debugSettings:t})=>{const{scene:n}=We();let r=n.getObjectByName("cameraFocusObject");if(!r){if(r=new Fn,r.name="cameraFocusObject",e!=null&&e.lookAt&&r.position.set(e.lookAt.x,e.lookAt.y,e.lookAt.z),t!=null&&t.allTrue){const a=new Fa(.05,32,32),o=new yi({color:16711680}),l=new Rt(a,o);r.add(l)}n.add(r)}return null};$n({ShaderMaterial:$e});const Jl=()=>{const e=v.useRef(null),t=v.useMemo(()=>{const r=new Si,a=[],o=[];for(let l=0;l<1e3;l++){const u=gn.randFloatSpread(6),d=Math.max(-10,gn.randFloatSpread(10)),h=gn.randFloatSpread(6);a.push(u,d,h),o.push(Math.random()*3+.5)}return r.setAttribute("position",new dr(a,3)),r.setAttribute("size",new dr(o,1)),r},[]),n=v.useMemo(()=>new $e({uniforms:{color:{value:new en("white")},time:{value:0}},vertexShader:`
        uniform vec3 color;
        attribute float size;
        varying vec3 vColor;
        uniform float time;

        void main() {
          vColor = color;
          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          gl_PointSize = size * (8.0 / -mvPosition.z);
          gl_Position = projectionMatrix * mvPosition;
        }
        `,fragmentShader:`
        uniform float time;
        varying vec3 vColor;

        void main() {
          float brightness = abs(sin(time + gl_FragCoord.x / 100.0));
          vec3 lightBlue = vec3(1.0, 1.0, 1.0);

          vec2 coordinates = 2.0 * gl_PointCoord - 1.0;
          float radius = dot(coordinates, coordinates);
          if (radius > 1.0) {
            discard;
          }

          float glow = 1.0 - radius;
          gl_FragColor = vec4(lightBlue * brightness * glow, brightness * glow * 0.2);
        }
        `,transparent:!0,blending:Ua,depthTest:!1,depthWrite:!1}),[]);return pt(({clock:r})=>{e.current&&(n.uniforms.time.value=r.getElapsedTime())}),N.jsx("points",{ref:e,geometry:t,material:n})};let jn=!1;const ac=()=>{const e=v.useRef(null),t=v.useRef(null),n=v.useRef(null),[r,a]=v.useState(!1),o=()=>{a(_=>!_)},[l,u]=v.useState(!1),d=()=>{u(_=>!_)},[h,g]=v.useState(!1),y=()=>{g(_=>!_)};return v.useEffect(()=>{jn=h},[h]),N.jsx("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",backgroundColor:"#666666"},children:N.jsxs(jl,{initialPoi:On.parentPoi,children:[N.jsxs(Ha,{ref:e,camera:{position:new Se(0,2,10),near:2e-5,far:1},gl:{powerPreference:"high-performance",alpha:!1,antialias:!0},shadows:!l,children:[N.jsx("color",{attach:"background",args:["#666666"]}),N.jsxs(v.Suspense,{fallback:N.jsx(Ql,{}),children:[N.jsx(Vl,{modelData:On.sceneModels}),N.jsx(Co,{files:"images/hdri/blurred.hdr"}),N.jsx(ec,{debugMode:h}),N.jsx(za,{frameSize:8}),N.jsx(Kl,{}),N.jsx(Xl,{modelData:On.sceneModels[0],scrollLength:10}),N.jsx(Jl,{}),N.jsx("fog",{attach:"fog",args:["#666666",40,60]}),r&&N.jsx(ka,{}),!l&&N.jsx(tc,{})]})]}),N.jsx("div",{id:"overlay",ref:t,className:"absolute left-0 top-0 h-full w-full pointer-events-none overflow-hidden"}),N.jsx("div",{ref:n,id:"ui-overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"hidden"},children:N.jsx(Ga,{showStats:r,onToggleStats:o,usePerformanceMode:l,onTogglePerformanceMode:d,debugMode:h,onToggleDebugMode:y})})]})})},ec=({debugMode:e})=>{const t=v.useRef();return lo(e?t:null,Wa),N.jsxs("group",{children:[N.jsx("directionalLight",{color:"#ffffff",position:[5,5,-10],castShadow:!0,intensity:20,"shadow-mapSize":[1024,1024],"shadow-bias":-.01}),N.jsx("directionalLight",{position:[-5,5,5],intensity:.4,"shadow-mapSize":[128,128]}),N.jsx("directionalLight",{position:[-5,5,-5],intensity:.4,"shadow-mapSize":[128,128]}),N.jsx("directionalLight",{position:[0,5,0],intensity:.4,"shadow-mapSize":[128,128]})]})},tc=()=>N.jsx(N.Fragment,{children:N.jsxs(Hl,{children:[N.jsx(kl,{}),N.jsx(Gl,{eskil:!1,offset:.1,darkness:.8})]})});export{ac as default,jn as useDebug};
